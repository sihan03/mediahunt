(function(g){var window=this;'use strict';var ODE=function(z){var p=new g.Vq("und",new g.EP("Default","und",!0));p.captionTracks=z.captionTracks;return p},wFq=function(z){return new g.O9(function(p,c){var B=z.length,H=[];
if(B)for(var T=function(X,x){B--;H[X]=x;B==0&&p(H)},b=function(X){c(X)},D,t=0;t<z.length;t++)D=z[t],g.r5f(D,g.f_(T,t),b);
else p(H)})},y4=function(z){this.W=z},Cs=function(){y4.apply(this,arguments)},RPJ=function(){Cs.apply(this,arguments)},SaK=function(){Cs.apply(this,arguments)},$7d=function(){Cs.apply(this,arguments)},KMQ=function(){Cs.apply(this,arguments)},uWz=function(){Cs.apply(this,arguments)},aYE=function(){Cs.apply(this,arguments)},ZDK=function(){y4.apply(this,arguments)},LMQ=function(){Cs.apply(this,arguments)},d7E=function(){Cs.apply(this,arguments)},WMq=function(){Cs.apply(this,arguments)},yeJ=function(){Cs.apply(this,
arguments)},CYJ=function(){Cs.apply(this,arguments)},ePd=function(){Cs.apply(this,arguments)},lY3=function(){Cs.apply(this,arguments)},vY$=function(){Cs.apply(this,arguments)},IYJ=function(){Cs.apply(this,arguments)},jeE=function(){Cs.apply(this,arguments)},FMQ=function(){Cs.apply(this,arguments)},oYK=function(){Cs.apply(this,arguments)},nYg=function(){y4.apply(this,arguments)},Qed=function(){Cs.apply(this,arguments)},re1=function(){Cs.apply(this,arguments)},U71=function(){Cs.apply(this,arguments)},
sem=function(){Cs.apply(this,arguments)},kiQ=function(){Cs.apply(this,arguments)},gYq=function(){Cs.apply(this,arguments)},GiK=function(){Cs.apply(this,arguments)},NI$=function(){Cs.apply(this,arguments)},fY3=function(){Cs.apply(this,arguments)},zym=function(){y4.apply(this,arguments)},pR9=function(){y4.apply(this,arguments)},cYd=function(){y4.apply(this,arguments)},B7v=function(){Cs.apply(this,arguments)},HE$=function(){Cs.apply(this,arguments)},iEg=function(){Cs.apply(this,arguments)},T7v=function(){Cs.apply(this,
arguments)},bEm=function(){Cs.apply(this,arguments)},VPl=function(){Cs.apply(this,arguments)},Drq=function(){Cs.apply(this,arguments)},tPl=function(){Cs.apply(this,arguments)},XR1=function(){Cs.apply(this,arguments)},xr9=function(){Cs.apply(this,arguments)},EVv=function(){Cs.apply(this,arguments)},qkz=function(){Cs.apply(this,arguments)},JYv=function(){Cs.apply(this,arguments)},MPQ=function(){Cs.apply(this,arguments)},Yk1=function(){Cs.apply(this,arguments)},mr$=function(){Cs.apply(this,arguments)},
hyJ=function(){Cs.apply(this,arguments)},PWm=function(){Cs.apply(this,arguments)},AYE=function(){Cs.apply(this,arguments)},OEz=function(){Cs.apply(this,arguments)},wRK=function(){Cs.apply(this,arguments)},RyJ=function(){Cs.apply(this,arguments)},Sk9=function(){Cs.apply(this,arguments)},$rK=function(){Cs.apply(this,arguments)},K_L=function(){Cs.apply(this,arguments)},uuv=function(){Cs.apply(this,arguments)},acg=function(){y4.apply(this,arguments)},ZEm=function(){Cs.apply(this,arguments)},L_d=function(){Cs.apply(this,
arguments)},drK=function(){Cs.apply(this,arguments)},W_g=function(){Cs.apply(this,arguments)},yYm=function(){Cs.apply(this,arguments)},CWJ=function(){Cs.apply(this,arguments)},ey$=function(){Cs.apply(this,arguments)},lcz=function(){Cs.apply(this,arguments)},vVL=function(){Cs.apply(this,arguments)},IcJ=function(){Cs.apply(this,arguments)},j2q=function(){Cs.apply(this,arguments)},F_l=function(){Cs.apply(this,arguments)},oVL=function(){Cs.apply(this,arguments)},nVz=function(){Cs.apply(this,arguments)},
Q2J=function(){Cs.apply(this,arguments)},rYz=function(){Cs.apply(this,arguments)},UrQ=function(){Cs.apply(this,arguments)},s2Q=function(){Cs.apply(this,arguments)},k$v=function(){Cs.apply(this,arguments)},gV3=function(){Cs.apply(this,arguments)},G$$=function(){Cs.apply(this,arguments)},N71=function(){Cs.apply(this,arguments)},fc9=function(){Cs.apply(this,arguments)},z93=function(){Cs.apply(this,arguments)},pxd=function(){Cs.apply(this,arguments)},c_q=function(){Cs.apply(this,arguments)},BYd=function(){Cs.apply(this,
arguments)},H49=function(){Cs.apply(this,arguments)},i4l=function(){Cs.apply(this,arguments)},TYJ=function(){Cs.apply(this,arguments)},b49=function(){Cs.apply(this,arguments)},Vz1=function(){Cs.apply(this,arguments)},DyJ=function(z){z=z.key||z.id;
if(!z)throw Error("Entity key is missing");return z},tz9=function(){if(em)return em();
var z={};em=g.bH("PersistentEntityStoreDb",{Pe:(z.EntityStore={Jm:1},z.EntityAssociationStore={Jm:2},z),shared:!1,upgrade:function(p,c){c(1)&&g.oO(g.ej(p,"EntityStore",{keyPath:"key"}),"entityType","entityType");c(2)&&(p=g.ej(p,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.oO(p,"byParentEntityKey","parentEntityKey"),g.oO(p,"byChildEntityKey","childEntityKey"))},
version:3});return em()},Xx9=function(z){return g.G6(tz9(),z)},xyg=function(z){return g.G6((0,g.fBl)(),z)},lw=function(z){this.token=z},vo=function(z,p){p=p===void 0?{}:p;
g.z6.call(this,g.zkl[z],Object.assign({},{name:"PESEncoderError",type:z},p));this.type=z;this.level="WARNING";Object.setPrototypeOf(this,vo.prototype)},EmE=function(z){return new vo("WRONG_DATA_TYPE",{e7:z})},qgQ=function(z){return z instanceof Error?new vo("UNKNOWN_ENCODE_ERROR",{d9:z.message}):new vo("UNKNOWN_ENCODE_ERROR")},J_L=function(z){return z instanceof Error?new vo("UNKNOWN_DECODE_ERROR",{d9:z.message}):new vo("UNKNOWN_DECODE_ERROR")},MzJ=function(z,p){z=z instanceof vo?z:p(z);
g.Fr(z);throw z;},Yg$=function(){},myK=function(z,p,c){try{return z.D(p,c)}catch(B){MzJ(B,qgQ)}},h9L=function(z){z=(new TextEncoder).encode(z).subarray(0,16);
var p=new Uint8Array(16);p.set(z);return p},Io=function(z){this.W=z},A_z=function(z){var p=Pnm[z];
if(p)return p;g.oc(new g.z6("Entity model not found.",{entityType:z}))},O4g=function(z,p){this.W=z;
this.K=p;this.D={}},R99=function(z,p){a:{z=wxq(z.K,p.version);
try{var c=z.K(p.data,p.key);break a}catch(B){MzJ(B,J_L)}c=void 0}return c},jm=function(z,p,c){return z.W.objectStore("EntityStore").get(p).then(function(B){if(B){if(c&&B.entityType!==c)throw Error("Incorrect entity type");
return R99(z,B)}})},Ft=function(z,p,c){return c?(c=c.map(function(B){return jm(z,B,p)}),g.Zg.all(c)):z.W.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(p)).then(function(B){return B.map(function(H){return R99(z,H)})})},ns=function(z,p,c){var B=DyJ(p),H=wxq(z.K,1),T=Object.assign({},p);
return z.W.objectStore("EntityStore").get(B).then(function(b){if(b){if(b.entityType!==c)throw Error("Incorrect entity type");T.entityMetadata||(b=R99(z,b),T.entityMetadata=b.entityMetadata)}}).then(function(){var b={key:B,
entityType:c,data:myK(H,T,B),version:1};return g.Zg.all([g.IO(z.W.objectStore("EntityStore"),b),SgL(z,T,c)])}).then(function(){oo(z,B,c);
return B})},$y1=function(z,p,c){p=p.map(function(B){return ns(z,B,c)});
return g.Zg.all(p)},Q4=function(z,p,c){if(c==null?0:c.K6){var B=new Set;
return Kmm(z,p,B).then(function(){for(var T=[],b=g.m(B),D=b.next();!D.done;D=b.next())T.push(Q4(z,D.value));return g.Zg.all(T).then(function(){})})}var H=g.Jz(p).entityType;
return g.Zg.all([z.W.objectStore("EntityStore").delete(p),ui$(z,p)]).then(function(){oo(z,p,H)})},aR1=function(z,p){return g.Um(z.W.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(p)},function(c){return g.Zg.all([c.delete(),
ui$(z,c.cursor.primaryKey)]).then(function(){oo(z,c.cursor.primaryKey,p);return g.Q2(c)})})},Z4E=function(z,p,c,B){var H=wxq(z.K,1);
return jm(z,p,B).then(function(T){if(T){T=g.Se(T,c);var b={key:p,entityType:B,data:myK(H,T,p),version:1};return g.Zg.all([g.IO(z.W.objectStore("EntityStore"),b),SgL(z,T,B)])}}).then(function(){oo(z,p,B);
return p})},oo=function(z,p,c){var B=z.D[c];
B||(B=new Set,z.D[c]=B);B.add(p)},LmK=function(z,p,c){var B=DyJ(p);
c=A_z(c);if(!c)return g.Zg.resolve([]);c=new c(p);z=z.W.objectStore("EntityAssociationStore");p=[];c=g.m(c.K());for(var H=c.next();!H.done;H=c.next())p.push(g.IO(z,{parentEntityKey:B,childEntityKey:H.value}));return g.Zg.all(p).then(function(T){return T.map(function(b){return b[1]})})},ui$=function(z,p){return z.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(p))},SgL=function(z,p,c){var B=DyJ(p);
return ui$(z,B).then(function(){return LmK(z,p,c)})},Kmm=function(z,p,c){if(c.has(p))return g.Zg.resolve(void 0);
c.add(p);return dyd(z,p).then(function(B){return z.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(p)).then(function(){return B})}).then(function(B){var H=g.Zg.resolve(void 0);
B=g.m(B);for(var T=B.next(),b={};!T.done;b={pX:void 0},T=B.next())b.pX=T.value,H=H.then(function(D){return function(){return Kmm(z,D.pX,c)}}(b));
return H}).then(function(){})},dyd=function(z,p){var c=z.W.objectStore("EntityAssociationStore");
return c.index("byParentEntityKey").getAll(IDBKeyRange.only(p)).then(function(B){var H=[];B=g.m(B);for(var T=B.next();!T.done;T=B.next())T=T.value,H.push(c.index("byChildEntityKey").getAll(T.childEntityKey));return g.Zg.all(H)}).then(function(B){var H=[];
B=g.m(B);for(var T=B.next();!T.done;T=B.next())T=T.value,T.length===1&&H.push(T[0].childEntityKey);return H})},rx=function(){},Wm1=function(){this.W={};
this.W[0]=new rx;if(!g.KN("aes_pes_encoder_killswitch")){var z=this.W;try{var p=g.pt();var c=h9L(p);var B=new Io(new g.L7(c),new g.ZG(c))}catch(H){throw z=H instanceof Error?new vo("KEY_CREATION_FAILED",{d9:H.message}):new vo("KEY_CREATION_FAILED"),g.Fr(z),z;}z[1]=B}},wxq=function(z,p){p=p===void 0?0:p;
z=z.W[p];if(!z)throw p=new vo("INVALID_ENCODER_VERSION",{e7:p}),g.Fr(p),p;return z},U1=function(z,p){g.e.call(this);
this.token=z;this.W=p;this.observers=[];z=new g.jQ.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.pt());z.onmessage=this.K.bind(this);this.channel=z},s1=function(z,p,c){var B,H,T,b;
return g.L(function(D){if(D.W==1)return g.a(D,Xx9(z.token),2);if(D.W!=3)return B=D.K,g.a(D,g.vJ(B,["EntityStore","EntityAssociationStore"],p,function(t){H=new O4g(t,z.W);return c(H)}),3);
T=D.K;H&&(b=H.D,Object.keys(b).length>0&&(z.channel.postMessage(b),y_z(z,b)));return D.return(T)})},ks=function(z,p,c){return s1(z,{mode:"readwrite",
xt:!0},function(B){return ns(B,p,c)})},Cnd=function(z,p){return s1(z,{mode:"readwrite",
xt:!0},function(c){return $y1(c,p,"offlineOrchestrationActionWrapperEntity")})},e99=function(z,p){return s1(z,{mode:"readwrite",
xt:!0},function(c){return Q4(c,p)})},lRg=function(z){return s1(z,{mode:"readwrite",
xt:!0},function(p){return aR1(p,"videoPlaybackPositionEntity")})},gx=function(z,p,c){return s1(z,{mode:"readonly",
xt:!0},function(B){return jm(B,p,c)})},GA=function(z,p,c){return s1(z,{mode:"readonly",
xt:!0},function(B){return Ft(B,p,c)})},y_z=function(z,p){z=g.m(z.observers);
for(var c=z.next();!c.done;c=z.next())c=c.value,c(p)},vmJ=function(){var z,p,c;
return g.L(function(B){if(B.W==1)return g.Ox(B,2),g.a(B,g.iH(),4);if(B.W!=2){z=B.K;if(!z||!g.cJ()||typeof g.jQ.BroadcastChannel==="undefined")return B.return();p=new Wm1;return B.return(new U1(z,p))}c=g.SQ(B);c instanceof Error&&g.Fr(c);return B.return()})},NX=function(){IRm||(IRm=vmJ());
return IRm},jjE=function(z){var p;
z=(p=z.options)==null?void 0:p.persistenceOption;return z==="ENTITY_PERSISTENCE_OPTION_PERSIST"||z==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},Fm1=function(z){var p;
return g.L(function(c){return c.W==1?g.a(c,NX(),2):(p=c.K)?g.a(c,s1(p,"readwrite",function(B){for(var H={},T=g.m(z),b=T.next(),D={};!b.done;D={kE:void 0,Gh:void 0},b=T.next())D.kE=b.value,D.kE.entityKey&&jjE(D.kE)&&(D.Gh=g.uU(D.kE.payload),b=void 0,D.kE.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(b=function(t){return function(){return ns(B,t.kE.payload[t.Gh],t.Gh)}}(D)),D.kE.type==="ENTITY_MUTATION_TYPE_DELETE"&&(b=function(t){return function(){return Q4(B,t.kE.entityKey)}}(D)),D.kE.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(b=function(t){return function(){return Z4E(B,t.kE.entityKey,t.kE.payload[t.Gh],t.Gh)}}(D)),b&&(H[D.kE.entityKey]=H[D.kE.entityKey]?H[D.kE.entityKey].then(b):b()));
return g.Zg.all(Object.values(H))}),0):c.return()})},omK=function(z){var p;
return g.L(function(c){if(c.W==1){p=z.mutations;if(!p||p.length<=0)return c.return();if(g.VN){var B={type:"ENTITY_LOADED"};p!==void 0&&(B.payload=p);g.VN.dispatch(B)}return g.a(c,Fm1(p),2)}p.length=0;g.Ai(c)})},nm3=function(z){return z!==void 0},Qjq=function(z){var p=g.yv();
p=Object.assign({},p);z=Object.assign({},z);for(var c in p)z[c]?(p[c]!==4&&(p[c]=z[c]),delete z[c]):p[c]!==2&&(p[c]=4);Object.assign(p,z);g.ili(p);JSON.stringify(p);return p},r_$=function(z){var p,c;
return g.L(function(B){if(B.W==1)return g.a(B,g.iH(),2);if(B.W!=3)return(p=B.K)?g.a(B,g.li(p),3):B.return();c=B.K;return B.return(g.vJ(c,["index","media","captions"],{mode:"readwrite",xt:!0},function(H){var T=IDBKeyRange.bound(z+"|",z+"~");H=[H.objectStore("index").delete(T),H.objectStore("media").delete(T),H.objectStore("captions").delete(T)];return g.Zg.all(H).then(function(){})}))})},Uyv=function(){var z,p;
return g.L(function(c){if(c.W==1)return g.a(c,g.iH(),2);if(c.W!=3){z=c.K;if(!z)throw g.uR("rvdfd");return g.a(c,g.li(z),3)}p=c.K;return c.return(g.vJ(p,["index","media"],{mode:"readwrite",xt:!0},function(B){var H={};return g.nt(B.objectStore("index"),{},function(T){var b=T.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),D=g.Zg.resolve(void 0);if(b){var t=b[1];b=b[2];H[t]=H[t]||{};var X;H[t][b]=g.tRY((X=T.getValue())==null?void 0:X.fmts)}else D=T.delete().then(function(){});
return g.Zg.all([g.Q2(T),D]).then(function(x){return g.m(x).next().value})}).then(function(){for(var T={},b=g.m(Object.keys(H)),D=b.next();!D.done;D=b.next()){D=D.value;
var t=H[D].v;T[D]=H[D].a&&t?1:2}var X=Qjq(T);return g.Wax(B.objectStore("media"),{},function(x){var E=x.cursor.key.match(g.qTS);E&&T[E[1]]||B.objectStore("media").delete(x.cursor.key);return g.R_N(x)}).then(function(){return X})})}))})},sj1=function(z,p){var c,B;
return g.L(function(H){if(H.W==1)return g.a(H,g.iH(),2);if(H.W!=3){c=H.K;if(!c)throw g.uR("wct");return g.a(H,g.li(c),3)}B=H.K;return g.a(H,g.vJ(B,["captions"],{mode:"readwrite",xt:!0},function(T){var b=[];T=T.objectStore("captions");for(var D=0;D<p.length;D++){var t=g.IO(T,p[D],z+"|"+p[D].metadata.vss_id);b.push(t)}return g.Zg.all(b)}),0)})},kXq=function(z){var p,c,B;
return g.L(function(H){if(H.W==1)return p=IDBKeyRange.bound(z+"|",z+"~"),g.a(H,g.iH(),2);if(H.W!=3){c=H.K;if(!c)throw g.uR("gactfv");return g.a(H,g.li(c),3)}B=H.K;return H.return(B.getAll("captions",p))})},gmL=function(z){return g.L(function(p){g.eO(z,0);
return p.return(r_$(z))})},GXl=function(z){return{context:g.Tl(),
videoIds:z}},NYL=function(z){return{context:g.Tl(),
playlistIds:z}},fRL=function(z){return{context:g.Tl(),
offlinePlaylistSyncChecks:z}},zT$=function(){this.W=new Map},cEz=function(){pVK||(pVK=new zT$);
return pVK},BKg=function(z,p){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:z},metadata:p,statusCode:void 0,csn:void 0,can:void 0}},Hxz=function(z,p,c){if(!c){var B=B===void 0?!1:B;
c=z.W.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!c||B)c=g.Zu(16),z.W.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",c)}z={flowNonce:c,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:p.eventType};p.metadata&&(z.flowMetadata=p.metadata);p.statusCode!==void 0&&(z.flowEventStatus=p.statusCode);p.csn&&(z.csn=p.csn);p.can&&(z.can=p.can);g.MG("flowEvent",z,void 0)},ixz=function(z){var p,c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md,uf,zv,bE,m1,w,S,u;
return g.L(function(d){if(d.W==1)return g.a(d,s1(z,{mode:"readonly",xt:!0},function(C){return Ft(C,"playbackData").then(function(p_){var TY=p_.map(function(mS){return mS.transfer}).filter(function(mS){return!!mS}),bf=p_.map(function(mS){return mS.offlineVideoPolicy}).filter(function(mS){return!!mS}),y=p_.filter(function(mS){return!!mS.key}).map(function(mS){return g.M9(g.Jz(mS.key).entityId,"downloadStatusEntity")});
TY=Ft(C,"transfer",TY);bf=Ft(C,"offlineVideoPolicy",bf);y=Ft(C,"downloadStatusEntity",y);var xB=TY.then(function(mS){mS=mS.reduce(function(ti,du){(du==null?0:du.offlineVideoStreams)&&ti.push.apply(ti,g.A(du.offlineVideoStreams));return ti},[]).filter(function(ti){return!!ti});
return Ft(C,"offlineVideoStreams",mS)});
return g.Zg.all([TY,bf,xB,y]).then(function(mS){var ti=g.m(mS);mS=ti.next().value;var du=ti.next().value;var YL=ti.next().value;ti=ti.next().value;return[p_,mS,du,YL,ti]})})}),2);
if(d.W!=3)return p=d.K,g.a(d,s1(z,{mode:"readonly",xt:!0},function(C){return Ft(C,"mainDownloadsListEntity").then(function(p_){var TY,bf;return(bf=(TY=p_[0])==null?void 0:TY.downloads)!=null?bf:[]})}),3);
c=d.K;B=g.m(p);H=B.next().value;T=B.next().value;b=B.next().value;D=B.next().value;t=B.next().value;X=H;x=T;E=b;q=D;J=t;M={};P={};O={};R={};K={};Z=[];W=g.m(x);for(v=W.next();!v.done;v=W.next())(zY=v.value)&&(M[zY.key]=zY);U=g.m(E);for(HD=U.next();!HD.done;HD=U.next())(VW=HD.value)&&(P[VW.key]=VW);f=g.m(J);for(F=f.next();!F.done;F=f.next())(N=F.value)&&(O[N.key]=N);h=g.m(q);for(n=h.next();!n.done;n=h.next())(FY=n.value)&&(R[FY.key]=FY);Rg=g.m(c);for(Md=Rg.next();!Md.done;Md=Rg.next())uf=Md.value,zv=
void 0,K[(zv=uf.videoItem)!=null?zv:""]=!0,uf.videoItem&&(m1=bE=void 0,w=(m1=(bE=g.Jz(uf.videoItem))==null?void 0:bE.entityId)!=null?m1:"",Z.push({externalVideoId:w}));S=X.filter(function(C){if(!C||!C.key||!C.offlineVideoPolicy)return!1;C=g.Jz(C.key).entityId;C=g.M9(C,"downloadStatusEntity");var p_;return!(C&&((p_=O[C])==null?void 0:p_.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
u=S.map(function(C){var p_=M[C.transfer],TY=[];if(p_==null?0:p_.offlineVideoStreams)for(var bf=g.m(p_.offlineVideoStreams),y=bf.next();!y.done;y=bf.next())(y=R[y.value])&&TY.push(y);bf=P[C.offlineVideoPolicy];y=K;var xB=C==null?void 0:C.playerResponseTimestamp,mS=g.Jz(bf.key).entityId;C=g.M9(mS,"mainVideoEntity");if(bf.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var ti="OFFLINE_VIDEO_STATE_DISABLED";bf.expirationTimestamp&&Number(bf.expirationTimestamp)<Date.now()/1E3&&(ti="OFFLINE_VIDEO_STATE_EXPIRED")}else if(bf.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")ti="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(p_==null?void 0:p_.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":ti="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":ti="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":ti="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":ti="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":ti="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":ti="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:ti="OFFLINE_VIDEO_STATE_UNKNOWN"}if(ti==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(p_==null?void 0:p_.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":ti="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":ti="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":ti=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}mS={id:mS,videoState:ti};if(p_==null?0:p_.cotn)mS.cotn=p_.cotn;if(p_==null?0:p_.maximumDownloadQuality)mS.selectedVideoQuality=p_==null?void 0:p_.maximumDownloadQuality;if(p_==null?0:p_.lastProgressTimeMs)mS.lastProgressTimeMs=p_.lastProgressTimeMs;xB&&(mS.playerResponseSavedTimeMs=String(Number(xB)*1E3));p_=String;xB=0;TY=g.m(TY);for(ti=TY.next();!ti.done;ti=TY.next())if(ti=ti.value,ti.streamsProgress){ti=g.m(ti.streamsProgress);for(var du=ti.next();!du.done;du=
ti.next()){var YL=void 0;xB+=Number((YL=du.value.numBytesDownloaded)!=null?YL:0)}}mS.downloadedBytes=p_(xB);mS.selectedOfflineMode=y[C]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";bf.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(mS.offlinePlaybackDisabledReason=bf.offlinePlaybackDisabledReason);return mS});
return d.return({offlineVideos:u,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:Z}}})})},TKQ=function(){this.locks=navigator.locks},bx1=function(){try{var z=g.n_("ytglobal.locks_");
if(z)return z;var p;if(p=navigator){var c=navigator;p="locks"in c&&!!c.locks}if(p)return g.jQ.localStorage&&g.jQ.localStorage.getItem("noop"),z=new TKQ,g.oE("ytglobal.locks_",z),z}catch(B){}},fs=function(){},Vuv=function(){},D3m=function(z){if(z.includes(":"))throw Error("Invalid user cache name: "+z);
return z+":"+g.pt("CacheStorage get")},tum=function(){return g.L(function(z){if(zR!==void 0)return z.return(zR);
zR=new Promise(function(p){var c;return g.L(function(B){switch(B.W){case 1:return g.Ox(B,2),g.a(B,p1.open("test-only"),4);case 4:return g.a(B,p1.delete("test-only"),5);case 5:g.RE(B,3);break;case 2:if(c=g.SQ(B),c instanceof Error&&c.name==="SecurityError")return p(!1),B.return();case 3:p("caches"in window),g.Ai(B)}})});
return z.return(zR)})},x3v=function(){return g.L(function(z){if(z.W==1)return g.a(z,tum(),2);
if(!z.K)return z.return(void 0);XVm||(XVm=new Vuv);return z.return(XVm)})},c0=function(z,p,c){g.oc(new g.z6("Woffle: "+z,c?{cotn:c}:""));
p instanceof Error&&g.oc(p)},EO3=function(z){var p;
return g.L(function(c){if(c.W==1)return g.a(c,ixz(z),2);p=c.K;g.MG("offlineStateSnapshot",p);g.Ai(c)})},B0=function(z){g.e.call(this);
var p=this;this.api=z;this.Xg={QJH:function(){return p.W},
BKa:function(){return p.K}};
typeof g.jQ.BroadcastChannel!=="undefined"&&(this.W=new g.jQ.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.pt()),this.W.onmessage=this.D.bind(this),this.K=new g.jQ.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.pt()),this.K.onmessage=this.X.bind(this))},H0=function(z,p){z.api.AD("onOfflineOperationFailure",p);
var c;(c=z.W)==null||c.postMessage(p)},qY1=function(z,p,c,B){var H=this;
this.S=z;this.U=p;this.visibility=c;this.Y=B;this.L=this.G=this.V=this.D=this.W=!1;this.X=new g.B4(function(){H.pS()});
this.Xg={zX:function(){return H.K},
pS:function(){H.pS()},
S0H:function(){return H.X}};
this.visibility.subscribe("visibilitystatechange",function(){H.mV()})},JEv=function(z){if(!z.D&&!z.W){var p=bx1();
if(p){z.D=!0;var c=g.pt("OfflineLockManager");p.request("woffle_orchestration_leader:"+c,{},function(){var B,H,T,b;return g.L(function(D){switch(D.W){case 1:return g.Ox(D,2),z.K=new g.OE,z.W=!0,z.D=!1,g.a(D,z.S(),4);case 4:return g.a(D,z.K.promise,5);case 5:g.RE(D,0);break;case 2:B=g.SQ(D),((T=(H=z).Y)==null?0:T.call(H,"wo_relinquish_leadership_on_lock_request_error"))||z.pS(),B instanceof Error&&(b=B,b.args=[{name:"WoLockManagerError",CV:B.name}],g.Fr(b)),g.Ai(D)}})})}}},Mug=function(z){z.W&&(z.L=
!0,i7(z))},YYz=function(z,p){z.W&&(z.V=p,i7(z))},m3Q=function(z,p){z.W&&(z.G=p,i7(z))},i7=function(z){z.G&&z.V&&z.L&&z.visibility.isBackground()?g.H4(z.X,6E4):z.X.stop()},TR=function(z){var p;
z.offlineDeleteReason=(p=z.offlineDeleteReason)!=null?p:"OFFLINE_DELETE_REASON_UNKNOWN";var c;z.offlineModeType=(c=z.offlineModeType)!=null?c:"OFFLINE_NOW";g.MG("offlineDeleteEvent",z)},b7=function(z,p){var c=p.videoId;
var B=p.Ls;p=p.offlineModeType;z.encryptedVideoId=c;z.cotn=B==null?void 0:B.cotn;z.offlineabilityFormatType=B==null?void 0:B.maximumDownloadQuality;var H;z.isRefresh=(H=B==null?void 0:B.isRefresh)!=null?H:!1;var T;z.softErrorCount=(T=B==null?void 0:B.transferRetryCount)!=null?T:0;z.offlineModeType=p!=null?p:"OFFLINE_NOW";(z.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&z.statusType==="UNKNOWN_STATUS_TYPE"||!z.transferStatusType&&!z.statusType)&&g.oc(Error("Woffle unknown transfer status"));
g.MG("offlineTransferStatusChanged",z)},hT1=function(z,p,c,B){B={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!B};p&&c&&(p=Math.floor(p/1024).toFixed(),c=Math.floor(c/1024).toFixed(),B.alreadyDownloadedKbytes=p,B.totalFetchedKbytes=p,B.totalContentKbytes=c);b7(B,z)},P61=function(z){b7({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},z)},AEd=function(z){switch(z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
V6=function(z){var p,c,B;
return((B=(p=z.actionMetadata)==null?void 0:(c=p.retryScheduleIntervalsInSeconds)==null?void 0:c.length)!=null?B:0)>0},D4=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!z.entityKey},tK=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!z.entityKey},Xv=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!z.entityKey},Oxv=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!z.entityKey},
xz=function(z,p,c,B,H){H=H===void 0?!1:H;
var T,b,D,t,X,x;return g.L(function(E){if(E.W==1)return T=g.M9(z,p),b=g.M9(z,"downloadStatusEntity"),g.a(E,s1(c,{mode:"readonly",xt:!0},function(q){return g.Zg.all([jm(q,T,p),jm(q,b,"downloadStatusEntity")])}),2);
D=E.K;t=D.length?D[0]:void 0;if(!t)return E.hD(0);X=wVq;if(x=D.length>1?D[1]:void 0){if(x.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!H)return E.return();x.downloadState=B}else x={key:b,downloadState:B};g.sF(t,X,x);return g.a(E,s1(c,{mode:"readwrite",xt:!0},function(q){return g.Zg.all([ns(q,t,p),ns(q,x,"downloadStatusEntity")])}),0)})},Ef=function(z,p){return z.actionType===p.actionType&&z.entityKey===p.entityKey},qf=function(z,p){if(z&&z.transferState!=="TRANSFER_STATE_COMPLETE"&&z.transferState!==
"TRANSFER_STATE_FAILED"){var c=g.Jz(z.key).entityId;
b7({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:c,Ls:z,offlineModeType:p})}},JK=function(z){if(!z||!z.thumbnails)return[];
var p=[];z=g.m(z.thumbnails);for(var c=z.next();!c.done;c=z.next())c=c.value,c.url&&p.push(c.url);return p},RT3=function(z,p,c){c=c===void 0?[]:c;
var B,H,T,b,D,t,X,x,E,q,J,M,P;return g.L(function(O){if(O.W==1)return c.length?g.a(O,GA(z,p),2):O.return([]);B=O.K;H=new Set;T=g.m(B);for(b=T.next();!b.done;b=T.next())if(D=b.value,t=D.id||D.key)X=g.Jz(t).entityId,H.add(X);x=[];E=g.m(c);for(q=E.next();!q.done;q=E.next())J=q.value,M=J.offlineVideoData,P=void 0,((P=M)==null?0:P.videoId)&&!H.has(M.videoId)&&x.push(J);return O.return(x)})},SYQ=function(z,p,c){return new g.GU(z,{cotn:p,
raw_player_response:c,download_media:!0,start:Infinity,disable_watch_next:!0})},$3E=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Mf=function(z,p,c,B,H,T,b,D,t,X,x){this.entityType=z;
this.actionId=p;this.action=c;this.parentActionId=B;this.rootActionId=H===void 0?p:H;this.childActionIds=T;this.prereqActionId=b;this.postreqActionIds=D;this.hasChildActionFailed=X;this.retryScheduleIndex=0;this.W=x||Date.now();this.retryScheduleIndex=t||0},Yz=function(z){if(!z.key)throw Error("Entity key is required.");
if(!z.actionProto)throw Error("OfflineOrchestrationAction is required.");var p=g.Jz(z.key),c=g.Jz(z.actionProto.entityKey);return new Mf(c.entityType,p.entityId,z.actionProto,z.parentActionId,z.rootActionId,z.childActionIds,z.prereqActionId,z.postreqActionIds,z.retryScheduleIndex,z.hasChildActionFailed,Number(z.enqueueTimeSec)*1E3)},m3=function(z){return{key:g.M9(z.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:z.action,parentActionId:z.parentActionId,rootActionId:z.rootActionId,childActionIds:z.childActionIds,prereqActionId:z.prereqActionId,postreqActionIds:z.postreqActionIds,retryScheduleIndex:z.retryScheduleIndex,hasChildActionFailed:z.hasChildActionFailed,enqueueTimeSec:(z.W/1E3).toFixed()}},KkJ=function(){var z;
return g.L(function(p){return p.W==1?g.a(p,x3v(),2):(z=p.K)?p.return(z.delete("yt-player-local-img")):p.return(!0)})},hK=function(z){var p,c;
return g.L(function(B){if(B.W==1)return g.a(B,x3v(),2);if(B.W!=3){p=B.K;if(!p)throw Error("Cache API not supported");return z.length?g.a(B,p.open("yt-player-local-img"),3):B.return()}c=B.K;return g.a(B,Promise.all(z.map(function(H){return c.delete(H)})),0)})},P0=function(z){var p,c;
return g.L(function(B){if(B.W==1)return g.a(B,x3v(),2);if(B.W!=3){p=B.K;if(!p)throw Error("Cache API not supported");return z.length?g.a(B,p.open("yt-player-local-img"),3):B.return()}c=B.K;return g.a(B,c.addAll(z),0)})},AK=function(z,p,c,B,H){var T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md,uf,zv;
return g.L(function(bE){switch(bE.W){case 1:return T=g.M9(z,"mainVideoEntity"),b=g.M9(z,"ytMainChannelEntity"),D=g.M9(z,"transfer"),t=g.M9(z,"videoDownloadContextEntity"),g.a(bE,s1(p,{mode:"readonly",xt:!0},function(m1){return g.Zg.all([jm(m1,T,"mainVideoEntity"),jm(m1,b,"ytMainChannelEntity"),jm(m1,D,"transfer"),jm(m1,t,"videoDownloadContextEntity"),Ft(m1,"ytMainChannelEntity"),Ft(m1,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=bE.K;x=g.m(X);E=x.next().value;q=x.next().value;J=x.next().value;M=x.next().value;P=x.next().value;O=x.next().value;R=E;K=q;Z=J;W=M;v=P;zY=O;if(!R&&!K){bE.hD(3);break}U=R?JK(R.thumbnail):[];if(!K){HD=[];bE.hD(4);break}return g.a(bE,uFL(K,v),5);case 5:HD=bE.K;case 4:return VW=HD,g.a(bE,hK(U.concat(VW)),3);case 3:f=[];F=g.M9(z,"downloadStatusEntity");N=g.m(zY);for(h=N.next();!h.done;h=N.next())n=h.value,FY=g.Jz(n.key).entityId,Rg=Yz(n),Md=g.Jz(Rg.action.entityKey).entityId,FY!==z&&Md!==z||
Ef(c,n.actionProto)||f.push(n.key);return g.a(bE,s1(p,{mode:"readwrite",xt:!0},function(m1){var w=f.map(function(S){return Q4(m1,S)});
w.push(Q4(m1,T,{K6:!0}));w.push(Q4(m1,F,{K6:!0}));return g.Zg.all(w)}),7);
case 7:zv=(uf=W)==null?void 0:uf.offlineModeType,H&&(TR(H),H.offlineModeType&&(zv=H.offlineModeType)),qf(Z,zv),H0(B,{entityKey:T,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Ai(bE)}})},Lkg=function(z,p,c,B){var H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md,uf,zv,bE,m1,w,S,u,d,C,p_,TY,bf,y,xB,mS,ti,du,YL,jl,Jy;
return g.L(function(Ux){switch(Ux.W){case 1:return H=g.M9(z,"mainPlaylistEntity"),T=g.M9(z,"ytMainChannelEntity"),g.a(Ux,s1(p,{mode:"readonly",xt:!0},function(Fe){return g.Zg.all([jm(Fe,H,"mainPlaylistEntity"),jm(Fe,T,"ytMainChannelEntity"),Ft(Fe,"mainPlaylistEntity"),Ft(Fe,"mainDownloadsListEntity"),Ft(Fe,"ytMainChannelEntity"),Ft(Fe,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=Ux.K;D=g.m(b);t=D.next().value;X=D.next().value;x=D.next().value;E=D.next().value;q=D.next().value;J=D.next().value;M=t;P=X;O=x;R=E;K=q;Z=J;if(!M&&!P){Ux.hD(3);break}W=M?aL1(M):[];if(!P){v=[];Ux.hD(4);break}return g.a(Ux,uFL(P,K),5);case 5:v=Ux.K;case 4:return zY=v,g.a(Ux,hK(W.concat(zY)),3);case 3:U=[];HD=new Map;if(!M){Ux.hD(7);break}return g.a(Ux,Zx$(M,O,R),8);case 8:U=Ux.K;VW=g.m(U);for(f=VW.next();!f.done;f=VW.next())F=f.value,HD.set(F,{videoId:F,playlistId:z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.a(Ux,s1(p,{mode:"readonly",xt:!0},function(Fe){return g.Zg.all([Ft(Fe,"transfer"),Ft(Fe,"videoDownloadContextEntity")])}),9);
case 9:N=Ux.K;h=g.m(N);n=h.next().value;FY=h.next().value;Rg=n;Md=FY;uf=g.m(Rg);for(zv=uf.next();!zv.done;zv=uf.next())bE=zv.value,m1=g.Jz(bE.key).entityId,(w=HD.get(m1))&&bE&&(w.cotn=bE.cotn);S=g.m(Md);for(u=S.next();!u.done;u=S.next())d=u.value,C=g.Jz(d.key).entityId,(p_=HD.get(C))&&d&&(p_.offlineModeType=d.offlineModeType);case 7:TY=[];bf=g.m(Z);for(y=bf.next();!y.done;y=bf.next())xB=y.value,mS=g.Jz(xB.key).entityId,ti=Yz(xB),mS!==z&&ti.rootActionId!==z||Ef(c,xB.actionProto)||TY.push(xB.key);du=
g.M9(z,"mainPlaylistEntity");return g.a(Ux,s1(p,{mode:"readwrite",xt:!0},function(Fe){var t5=TY.map(function(C2){return Q4(Fe,C2)});
t5.push(Q4(Fe,du,{K6:!0}));return g.Zg.all(t5)}),10);
case 10:if(!M){Ux.hD(0);break}U.reverse();if(!U){Ux.hD(0);break}YL=g.m(U);jl=YL.next();case 13:if(jl.done){Ux.hD(0);break}Jy=jl.value;return g.a(Ux,AK(Jy,p,c,B,HD.get(Jy)),14);case 14:jl=YL.next(),Ux.hD(13)}})},Wk9=function(z,p,c,B){var H,T,b,D,t,X,x,E,q;
return g.L(function(J){if(J.W==1)return H=g.M9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),T=new Map,g.a(J,s1(z,{mode:"readwrite",xt:!0},function(M){var P=Ft(M,"transfer"),O=Ft(M,"offlineOrchestrationActionWrapperEntity"),R=Ft(M,"videoDownloadContextEntity"),K=jm(M,H,"mainDownloadsListEntity");return g.Zg.all([P,O,R,K]).then(function(Z){Z=g.m(Z);var W=Z.next().value;var v=Z.next().value;var zY=Z.next().value;var U=Z.next().value;Z=d3$.map(function(VW){return aR1(M,VW)});
v=g.m(v);for(var HD=v.next();!HD.done;HD=v.next())HD=HD.value,Ef(p,HD.actionProto)||Z.push(Q4(M,HD.key,{K6:!0}));U&&(U.downloads=[],Z.push(ns(M,U,"mainDownloadsListEntity")));if(zY)for(zY=g.m(zY),U=zY.next();!U.done;U=zY.next())U=U.value,v=g.Jz(U.key).entityId,v=g.M9(v,"transfer"),T.set(v,U.offlineModeType);return g.Zg.all(Z).then(function(){return W})})}),2);
b=J.K;D=g.m(b);for(t=D.next();!t.done;t=D.next())X=t.value,qf(X,T.get(X.key)),x=g.Jz(X.key).entityId,E={videoId:x,offlineDeleteReason:B,cotn:X.cotn,offlineModeType:T.get(X.key)},TR(E),q=g.M9(x,"mainVideoEntity"),H0(c,{entityKey:q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.a(J,KkJ(),0)})},aL1=function(z,p){var c=[];
if(z.thumbnailStyleData){z=g.m(z.thumbnailStyleData);for(var B=z.next();!B.done;B=z.next()){var H=void 0,T=void 0,b=void 0;c=c.concat(JK((H=B.value)==null?void 0:(T=H.value)==null?void 0:(b=T.collageThumbnail)==null?void 0:b.coverThumbnail))}}p=JK(p);return c.concat(p)},Zx$=function(z,p,c){var B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW;
return g.L(function(f){B=[];H=new Set;if(c.length)for(T=g.m(c),b=T.next();!b.done;b=T.next())if(D=b.value,t=void 0,(t=D.downloads)==null?0:t.length)for(X=g.m(D.downloads),x=X.next();!x.done;x=X.next())E=x.value,E.videoItem&&(q=g.Jz(E.videoItem).entityId,H.add(q));if(z.videos){J=g.m(z.videos);for(M=J.next();!M.done;M=J.next())P=M.value,O=JSON.parse(g.Jz(P).entityId),O.videoId&&!H.has(O.videoId)&&B.push(O.videoId);R=g.m(p);for(K=R.next();!K.done;K=R.next())if(Z=K.value,Z.key!==z.key&&(W=Z.videos))for(v=
g.m(W),zY=v.next();!zY.done;zY=v.next())U=zY.value,HD=JSON.parse(g.Jz(U).entityId),HD.videoId&&(VW=B.indexOf(HD.videoId),VW!==-1&&B.splice(VW,1))}return f.return(B)})},uFL=function(z,p){var c,B,H,T,b,D,t,X;
return g.L(function(x){c=JK(z.avatar);B=g.m(p);for(H=B.next();!H.done;H=B.next())if(T=H.value,T.id!==z.id)for(b=g.m(JK(T.avatar)),D=b.next();!D.done;D=b.next())t=D.value,X=c.indexOf(t),X!==-1&&c.splice(X,1);return x.return(c)})},yEL=function(z){var p;
return g.L(function(c){p=g.I(z.frameworkUpdates,Of);return z.frameworkUpdates&&p?g.a(c,omK(p),0):c.return()})},eT3=function(z){var p;
if((p=z.onResponseReceivedActions)!=null&&p.length){var c;z=(c=g.I(g.I(z.onResponseReceivedActions[0],C6l),g.sWv))==null?void 0:c.actions;if(z!=null&&z.length)return z}},lL3=function(z){var p,c,B;
return g.L(function(H){if(H.W==1)return z?g.a(H,gx(z,g.ZE,"mainDownloadsListEntity"),2):H.return([]);p=H.K;return((c=p)==null?0:(B=c.downloads)==null?0:B.length)?H.return(p.downloads.map(function(T){var b;return(b=T.videoItem)!=null?b:""})):H.return([])})},ILd=function(z,p){var c;
return g.L(function(B){return B.W==1?g.a(B,vOL(z,p),2):(c=B.K)?g.a(B,s1(z,{mode:"readwrite",xt:!0},function(H){var T=[ns(H,c.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];c.mainDownloadsListEntity&&T.push(ns(H,c.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Zg.all(T)}),0):B.hD(0)})},vOL=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z;
return g.L(function(W){if(W.W==1)return c=g.M9("main_downloads_library_id","mainDownloadsLibraryEntity"),B=g.M9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.a(W,s1(z,{mode:"readonly",xt:!0},function(v){return g.Zg.all([jm(v,c,"mainDownloadsLibraryEntity"),jm(v,B,"mainDownloadsListEntity")])}),2);
H=W.K;T=g.m(H);b=T.next().value;D=T.next().value;t=b;X=D;t||(t={id:c});x=g.m(p);for(E=x.next();!E.done;E=x.next())if(q=E.value,q===g.ZE){if(t.smartDownloadsList)return W.return();t.smartDownloadsList=q}else if(J=g.Jz(q).entityType,M={},J==="mainPlaylistEntity"?M.playlistItem=q:J==="mainVideoEntity"&&(M.videoItem=q),!g.y3(M)){P=void 0;if((P=X)==null?0:P.downloads){O=!1;R=g.m(X.downloads);for(K=R.next();!K.done;K=R.next())if(Z=K.value,Z.playlistItem===q||Z.videoItem===q){O=!0;break}O||X.downloads.push(M)}else X=
{id:B,downloads:[M]};t.downloadsList=B}return W.return({mainDownloadsLibraryEntity:t,mainDownloadsListEntity:X})})},jVm=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O;
return g.L(function(R){if(R.W==1)return c=g.M9("main_downloads_library_id","mainDownloadsLibraryEntity"),B=g.M9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.a(R,s1(z,{mode:"readonly",xt:!0},function(K){return g.Zg.all([jm(K,c,"mainDownloadsLibraryEntity"),jm(K,B,"mainDownloadsListEntity"),jm(K,g.ZE,"mainDownloadsListEntity")])}),2);
H=R.K;T=g.m(H);b=T.next().value;D=T.next().value;t=T.next().value;X=b;x=D;E=t;if(!X)return R.hD(0);if(p===g.ZE&&((q=E)==null?0:q.downloads))E.downloads=[];else if((J=x)==null?0:J.downloads)for(M=g.Jz(p).entityType,P=0;P<x.downloads.length;P++)if(O=x.downloads[P],M==="mainVideoEntity"&&O.videoItem===p){x.downloads.splice(P,1);break}else if(M==="mainPlaylistEntity"&&O.playlistItem===p){x.downloads.splice(P,1);break}return g.a(R,s1(z,{mode:"readwrite",xt:!0},function(K){var Z=[ns(K,X,"mainDownloadsLibraryEntity")];
x&&Z.push(ns(K,x,"mainDownloadsListEntity"));E&&Z.push(ns(K,E,"mainDownloadsListEntity"));return g.Zg.all(Z)}),0)})},wZ=function(z,p){var c,B,H,T,b,D,t,X,x,E,q;
return g.L(function(J){if(J.W==1)return c=g.M9(p,"transfer"),B=g.M9(p,"videoDownloadContextEntity"),g.a(J,s1(z,{mode:"readonly",xt:!0},function(M){return g.Zg.all([jm(M,c,"transfer"),jm(M,B,"videoDownloadContextEntity")])}),2);
H=J.K;T=g.m(H);b=T.next().value;D=T.next().value;t=b;X=D;q={videoId:p,cotn:(x=t)==null?void 0:x.cotn,offlineModeType:(E=X)==null?void 0:E.offlineModeType};return J.return(q)})},RT=function(z,p,c,B,H){var T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD;
return g.L(function(VW){switch(VW.W){case 1:return T=g.M9(z,"musicTrack"),b=g.M9(z,"transfer"),g.a(VW,s1(p,{mode:"readonly",xt:!0},function(f){return g.Zg.all([jm(f,T,"musicTrack"),jm(f,b,"transfer"),Ft(f,"musicTrack"),Ft(f,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=VW.K;t=g.m(D);X=t.next().value;x=t.next().value;E=t.next().value;q=t.next().value;J=X;M=x;P=E;O=q;if(!J){VW.hD(3);break}return g.a(VW,Fk$(J,P),4);case 4:return R=VW.K,g.a(VW,hK(R),3);case 3:K=[];Z=g.m(O);for(W=Z.next();!W.done;W=Z.next())v=W.value,zY=g.Jz(v.key).entityId,U=Yz(v),HD=g.Jz(U.action.entityKey).entityId,zY!==z&&HD!==z||Ef(c,v.actionProto)||K.push(v.key);return g.a(VW,s1(p,{mode:"readwrite",xt:!0},function(f){var F=K.map(function(N){return Q4(f,N)});
F.push(Q4(f,T,{K6:!0}));return g.Zg.all(F)}),6);
case 6:qf(M),H&&TR(H),H0(B,{entityKey:T,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Ai(VW)}})},S6=function(z,p,c,B,H){var T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md,uf,zv,bE,m1,w,S,u;
return g.L(function(d){switch(d.W){case 1:return T=g.M9(z,p),b=g.M9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.a(d,s1(c,{mode:"readonly",xt:!0},function(C){return g.Zg.all([jm(C,T,p),jm(C,b,"musicDownloadsLibraryEntity"),Ft(C,p),Ft(C,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=d.K;t=g.m(D);X=t.next().value;x=t.next().value;E=t.next().value;q=t.next().value;J=X;M=x;P=E;O=q;if(!J){d.hD(3);break}return g.a(d,Fk$(J,P),4);case 4:return R=d.K,g.a(d,hK(R),3);case 3:K=[];Z=new Map;if(!J){d.hD(6);break}return g.a(d,oOE(J,P,M),7);case 7:K=d.K;W=g.m(K);for(v=W.next();!v.done;v=W.next())zY=v.value,U=g.Jz(zY).entityId,Z.set(U,{videoId:U,playlistId:z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.a(d,GA(c,"transfer"),8);case 8:for(HD=d.K,VW=g.m(HD),
f=VW.next();!f.done;f=VW.next())F=f.value,N=g.Jz(F.key).entityId,(h=Z.get(N))&&F&&(h.cotn=F.cotn);case 6:n=[];FY=g.m(O);for(Rg=FY.next();!Rg.done;Rg=FY.next())Md=Rg.value,uf=g.Jz(Md.key).entityId,zv=Yz(Md),uf!==z&&zv.rootActionId!==z||Ef(B,Md.actionProto)||n.push(Md.key);bE=g.M9(z,p);return g.a(d,s1(c,{mode:"readwrite",xt:!0},function(C){var p_=n.map(function(TY){return Q4(C,TY)});
p_.push(Q4(C,bE,{K6:!0}));return g.Zg.all(p_)}),9);
case 9:if(!J){d.hD(0);break}K.reverse();if(!K.length){d.hD(0);break}m1=g.m(K);w=m1.next();case 12:if(w.done){d.hD(0);break}S=w.value;u=g.Jz(S).entityId;if(!u){d.hD(13);break}return g.a(d,RT(u,c,B,H,Z.get(u)),13);case 13:w=m1.next(),d.hD(12)}})},$z=function(z,p,c){var B,H,T,b,D,t,X;
return g.L(function(x){if(x.W==1)return g.a(x,s1(z,{mode:"readwrite",xt:!0},function(E){var q=Ft(E,"transfer"),J=Ft(E,"offlineOrchestrationActionWrapperEntity");return g.Zg.all([q,J]).then(function(M){M=g.m(M);var P=M.next().value;var O=M.next().value;M=nOK.map(function(W){return aR1(E,W)});
O=g.m(O);for(var R=O.next();!R.done;R=O.next()){R=R.value;var K=g.Jz(R.actionProto.entityKey).entityType==="musicTrack",Z=R.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Ef(p,R.actionProto)||K&&(!K||Z)||M.push(Q4(E,R.key,{K6:!0}))}return g.Zg.all(M).then(function(){return P})})}),2);
B=x.K;H=g.m(B);for(T=H.next();!T.done;T=H.next())b=T.value,qf(b),D=g.Jz(b.key).entityId,t={videoId:D,offlineDeleteReason:void 0,cotn:b.cotn},TR(t),X=g.M9(D,"musicTrack"),H0(c,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.a(x,KkJ(),0)})},QV3=function(z){for(var p,c=g.m(z.additionalMetadatas),B=c.next();!B.done;B=c.next())B=B.value,B.offlineMusicVideoData&&(p=B.offlineMusicVideoData);
var H,T,b,D,t;return{id:g.M9(z.videoId,"musicTrack"),videoId:z.videoId,title:z.title,thumbnailDetails:z.thumbnail,lengthMs:String(Number(z.lengthSeconds)*1E3),albumTitle:(H=p)==null?void 0:H.releaseTitle,musicVideoType:(T=p)==null?void 0:T.musicVideoType,contentRating:{explicitType:(b=p)==null?void 0:b.explicitType},artistNames:((D=p)==null?void 0:D.byline)||((t=p)==null?void 0:t.channelName),downloadMetadata:g.M9(z.videoId,"musicTrackDownloadMetadataEntity")}},oOE=function(z,p,c){var B,H,T,b,D,t,
X,x,E,q,J,M,P,O,R,K,Z,W;
return g.L(function(v){B=[];H=new Set;if((T=c)==null?0:(b=T.downloadedTracks)==null?0:b.length)for(D=g.m(c.downloadedTracks),t=D.next();!t.done;t=D.next())X=t.value,H.add(X);if(z.tracks){x=g.m(z.tracks);for(E=x.next();!E.done;E=x.next())q=E.value,H.has(q)||B.push(q);J=g.m(p);for(M=J.next();!M.done;M=J.next())if(P=M.value,P.id!==z.id&&(O=P.tracks))for(R=g.m(O),K=R.next();!K.done;K=R.next())Z=K.value,W=B.indexOf(Z),W!==-1&&B.splice(W,1)}return v.return(B)})},Fk$=function(z,p){var c,B,H,T,b,D,t,X;
return g.L(function(x){c=JK(z.thumbnailDetails);B=g.m(p);for(H=B.next();!H.done;H=B.next())if(T=H.value,T.id!==z.id)for(b=g.m(JK(T.thumbnailDetails)),D=b.next();!D.done;D=b.next())t=D.value,X=c.indexOf(t),X!==-1&&c.splice(X,1);return x.return(c)})},rE1=function(z,p){var c,B,H,T,b,D,t,X,x;
return g.L(function(E){if(E.W==1)return c=g.M9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.a(E,gx(z,c,"musicDownloadsLibraryEntity"),2);(B=E.K)||(B={id:c});H=g.Jz(p).entityType;H==="musicTrack"?(T=B.downloadedTracks)!=null&&T.includes(p)||(B.downloadedTracks=((b=B.downloadedTracks)!=null?b:[]).concat(p)):H==="musicPlaylist"?(D=B.downloadedPlaylists)!=null&&D.includes(p)||(B.downloadedPlaylists=((t=B.downloadedPlaylists)!=null?t:[]).concat(p)):H!=="musicAlbumRelease"||(X=B.downloadedAlbumReleases)!=
null&&X.includes(p)||(B.downloadedAlbumReleases=((x=B.downloadedAlbumReleases)!=null?x:[]).concat(p));return g.a(E,ks(z,B,"musicDownloadsLibraryEntity"),0)})},U39=function(z,p){var c,B,H,T,b,D,t;
return g.L(function(X){if(X.W==1)return c=g.M9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.a(X,gx(z,c,"musicDownloadsLibraryEntity"),2);B=X.K;if(!B)return X.hD(0);H=g.Jz(p).entityType;H==="musicTrack"?T=B.downloadedTracks:H==="musicPlaylist"&&(T=B.downloadedPlaylists);if((b=T)==null?0:b.length)for(D=0;D<T.length;D++)if(t=T[D],t===p){T.splice(D,1);break}return g.a(X,ks(z,B,"musicDownloadsLibraryEntity"),0)})},sVq=function(z){var p=z.videos;
z=[];var c=[];if(p){p=g.m(p);for(var B=p.next();!B.done;B=p.next()){var H=B.value.offlineVideoData.videoId;B=g.M9(H,"musicTrack");H=g.M9(H,"musicTrackDownloadMetadataEntity");z.push(B);c.push(H)}}return{qh:z,Lr:c}},K1=function(z,p,c){p={track:QV3(p)};
c&&(p.playlistId=c);if(z=g.I(z.actionMetadata,kwQ))p.maximumDownloadQuality=z.maximumDownloadQuality;return{musicTrackEntityActionMetadata:p}},Gwl=function(z){var p,c,B,H,T,b,D,t;
return g.L(function(X){switch(X.W){case 1:return p=g.q2(),c=GXl(z),B=g.D6(gOg),g.Ox(X,2),T={FE:!0},g.a(X,g.HY(p,c,B,void 0,T),4);case 4:H=X.K;g.RE(X,3);break;case 2:b=g.SQ(X);if(b instanceof g.pb)throw D="GetOffline network manager error: "+b.message,c0(D,b),Error(D);c0("GetOffline fetch request error",b);throw Error("GetOffline fetch request error");case 3:t=u7(H);if(!H)throw c0("Network request failed"),Error("Network request failed");if(t!==void 0)aT(t);else if(!H.videos||!H.videos.length)throw c0("No data"),
Error("No data");return X.return(H.videos.map(function(x){return x.offlineVideoData}))}})},NKE=function(z){var p,c,B,H,T,b,D,t;
return g.L(function(X){switch(X.W){case 1:return p=g.q2(),c=NYL(z),B=g.D6(gOg),g.Ox(X,2),T={FE:!0},g.a(X,g.HY(p,c,B,void 0,T),4);case 4:H=X.K;g.RE(X,3);break;case 2:b=g.SQ(X);if(b instanceof g.pb)throw D="GetOffline network manager error for playlist: "+b.message,c0(D,b),Error(D);c0("GetOffline fetch request error for playlist",b);throw Error("GetOffline fetch request error for playlist");case 3:t=u7(H);if(!H)throw c0("Network request failed for playlist"),Error("Network request failed for playlist");
if(t!==void 0)aT(t,"playlist");else if(!H.playlists||!H.playlists.length)throw c0("No data for playlist"),Error("No data for playlist");return X.return(H.playlists.map(function(x){return x.offlinePlaylistData}))}})},zRL=function(z,p,c,B){var H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md;
return g.L(function(uf){switch(uf.W){case 1:return g.a(uf,NX(),2);case 2:H=uf.K;if(!H)return uf.return([]);T=[];if((b=B)==null?0:b.length){T=B;uf.hD(3);break}return g.a(uf,GA(H,"mainPlaylistEntity"),4);case 4:T=uf.K;case 3:if(!T.length)return uf.return([]);D=[];t=Date.now()/1E3;X=g.m(T);x=X.next();case 5:if(x.done)return D.length?g.a(uf,fLK(D),10):uf.return([]);E=x.value;if(!E.downloadState){q=void 0;uf.hD(8);break}return g.a(uf,gx(H,E.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:q=
uf.K;case 8:J=q;M=void 0;O=(P=(M=E)==null?void 0:M.entityMetadata)&&P.nextAutoRefreshIntervalSeconds?Number(P.nextAutoRefreshIntervalSeconds):NaN;R=Number.isNaN(O)?z:O;Z=K=void 0;W=((K=J)==null?0:K.lastSyncedTimestampMillis)?Number((Z=J)==null?void 0:Z.lastSyncedTimestampMillis)/1E3:0;zY=v=void 0;U=((v=J)==null?0:v.addedTimestampMillis)?Number((zY=J)==null?void 0:zY.addedTimestampMillis)/1E3:0;if(c||!P||W+R<=t){HD=[];VW=void 0;if((VW=E.videos)==null?0:VW.length)for(f=g.m(E.videos),F=f.next();!F.done;F=
f.next())N=F.value,h=JSON.parse(g.Jz(N).entityId),h.videoId&&HD.push(h.videoId);n="0";P&&(FY=void 0,n=String(Number((FY=P.offlineLastModifiedTimestampSeconds)!=null?FY:0).toFixed()));Rg={playlistId:E.playlistId,videoIds:HD,offlineLastModifiedTimestamp:n,autoSync:p,offlineDateAddedTimestamp:String(U.toFixed())};D.push(Rg)}x=X.next();uf.hD(5);break;case 10:return Md=uf.K,uf.return(Md)}})},pOd=function(){var z,p,c,B,H;
return g.L(function(T){if(T.W==1)return g.a(T,NX(),2);if(T.W!=3)return(z=T.K)?g.a(T,GA(z,"refresh"),3):T.return(!1);p=T.K;if((c=p[0])==null||!c.refreshTime)return T.return(!1);B=Number(p[0].refreshTime);H=Date.now()/1E3;return T.return(isFinite(B)&&H>=B)})},B4l=function(z,p){var c,B,H;
return g.L(function(T){switch(T.W){case 1:return g.Ox(T,2),g.a(T,cSL(z,p),4);case 4:return B=T.K,g.a(T,yEL(B),5);case 5:c=eT3(B);g.RE(T,3);break;case 2:H=g.SQ(T),c0("getAndProcessSmartDownloadsResponse request or processing error",H);case 3:return T.return(c)}})},Ho1=function(z,p,c,B){var H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md;
return g.L(function(uf){switch(uf.W){case 1:return g.a(uf,NX(),2);case 2:H=uf.K;if(!H)return uf.return([]);T=[];if((b=B)==null?0:b.length){T=B;uf.hD(3);break}return g.a(uf,GA(H,"musicPlaylist"),4);case 4:T=uf.K;case 3:if(!T.length)return uf.return([]);D=[];t=Date.now()/1E3;X=g.m(T);x=X.next();case 5:if(x.done)return D.length?g.a(uf,fLK(D),10):uf.return([]);E=x.value;q=void 0;M=(J=(q=E)==null?void 0:q.entityMetadata)&&J.nextAutoRefreshIntervalSeconds?Number(J.nextAutoRefreshIntervalSeconds):NaN;P=
Number.isNaN(M)?z:M;R=O=0;K="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!E.downloadMetadata){uf.hD(8);break}return g.a(uf,gx(H,E.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:Z=uf.K,v=W=void 0,O=Number((v=(W=Z)==null?void 0:W.addedTimestampMillis)!=null?v:"0")/1E3,U=zY=void 0,R=Number((U=(zY=Z)==null?void 0:zY.lastModifiedTimestampMillis)!=null?U:"0")/1E3,VW=HD=void 0,K=(VW=(HD=Z)==null?void 0:HD.syncState)!=null?VW:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:f=void 0;if(c||K!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!J||Number((f=J.lastSyncedTimestampSeconds)!=null?f:0)+P<=t){F=[];N=void 0;if((N=E.tracks)==null?0:N.length)for(h=g.m(E.tracks),n=h.next();!n.done;n=h.next())FY=n.value,F.push(g.Jz(FY).entityId);Rg={playlistId:E.playlistId,videoIds:F,offlineLastModifiedTimestamp:String(R.toFixed()),autoSync:p,offlineDateAddedTimestamp:String(O.toFixed())};D.push(Rg)}x=X.next();uf.hD(5);break;case 10:return Md=uf.K,uf.return(Md)}})},cSL=function(z,p){var c,B,H,T,b,D,t,X,x,E;
return g.L(function(q){switch(q.W){case 1:return c=g.q2(),g.a(q,NX(),2);case 2:B=q.K;if(!B){q.hD(3);break}return g.a(q,ixz(B),4);case 4:H=q.K;case 3:var J=H;T={context:g.Tl(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:z},offlineClientState:J,clientStateRequestData:{preferredFormatType:p}}}};b=g.D6(ioK);g.Ox(q,5);t={FE:!0};return g.a(q,g.HY(c,T,b,void 0,t),7);case 7:D=q.K;g.RE(q,6);break;case 5:X=g.SQ(q);if(X instanceof g.pb)throw x=
"DPS network manager error for smart downloads: "+X.message,c0(x,X),Error(x);c0("DPS fetch request error for smart downloads",X);throw Error("DPS fetch request error for smart downloads");case 6:E=u7(D);if(D)E!==void 0&&aT(E,"smart downloads");else throw c0("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return q.return(D)}})},bo3=function(z,p){var c,B,H,T,b,D,t,X;
return g.L(function(x){switch(x.W){case 1:return c=g.q2(),B={context:g.Tl(),videoPlaybackPositionEntities:z,lastSyncTimestampUsec:p},H=g.D6(T4L),g.Ox(x,2),b={FE:!0},g.a(x,g.HY(c,B,H,void 0,b),4);case 4:T=x.K;g.RE(x,3);break;case 2:D=g.SQ(x);if(D instanceof g.pb)throw t="VPPS network manager error: "+D.message,c0(t,D),Error(t);c0("VPPS fetch request error",D);throw Error("VPPS fetch request error");case 3:X=u7(T);if(T)X!==void 0&&aT(X,"position sync");else throw c0("Network request failed for position sync"),
Error("Network request failed for position sync");return x.return(T)}})},DVd=function(z,p,c){var B,H,T,b,D,t,X,x;
return g.L(function(E){switch(E.W){case 1:B=g.q2();var q=c.refreshData,J=c.isEnqueuedForExpiredStreamUrlRefetch,M=c.E6,P=c.offlineSourceData,O=c.mediaCapabilities,R={entityKey:z};q&&(R.refreshData=q);J&&(R.isExpiredStreamUrlRefetch=J);M&&(R.downloadParameters=M);P&&(R.offlineSourceData=P);q={context:g.X7(p),signatureTimestamp:20166,videos:[R]};O&&(q.mediaCapabilities=O);H=q;T=g.D6(VV3);g.Ox(E,2);D={FE:!0};return g.a(E,g.HY(B,H,T,void 0,D),4);case 4:b=E.K;g.RE(E,3);break;case 2:t=g.SQ(E);if(t instanceof
g.pb)throw X="GetPDE network manager error: "+t.message,c0(X,t),Error(X);c0("GetPDE fetch request error",t);throw Error("GetPDE fetch request error");case 3:x=u7(b);if(b)x!==void 0&&aT(x,"PDE");else throw c0("Network request failed for PDE"),Error("Network request failed for PDE");return E.return(b)}})},u7=function(z){var p;
return(p=z.errorMetadata)==null?void 0:p.status},aT=function(z,p){p=p?" for "+p:"";
if(z===0)throw z="Empty response body"+p,c0(z),Error(z);z="Response with error"+p;c0(z);throw Error(z);},fLK=function(z){var p,c,B,H,T,b,D,t;
return g.L(function(X){switch(X.W){case 1:return p=g.q2(),c=fRL(z),B=g.D6(tVK),g.Ox(X,2),T={FE:!0},g.a(X,g.HY(p,c,B,void 0,T),4);case 4:H=X.K;g.RE(X,3);break;case 2:b=g.SQ(X);if(b instanceof g.pb)throw D="offlinePlaylistSyncCheck network manager error: "+b.message,c0(D,b),Error(D);c0("offlinePlaylistSyncCheck fetch request error",b);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:t=u7(H);if(!H)throw c0("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(t!==void 0)aT(t,"playlist sync");else if(!H.offlinePlaylistSyncCheckDatas||!H.offlinePlaylistSyncCheckDatas.length)throw c0("No data for playlist sync"),Error("No data for playlist sync");return X.return(H.offlinePlaylistSyncCheckDatas.map(function(x){return x.offlinePlaylistSyncCheckData}))}})},Z4=function(z){this.W=z},XOv=function(z,p){var c,B,H,T,b,D;
return g.L(function(t){switch(t.W){case 1:c=new Map,B=g.m(p),H=B.next();case 2:if(H.done){t.hD(4);break}T=H.value;b=c;D=b.set;return g.a(t,z.K(T),5);case 5:D.call(b,T,t.K);H=B.next();t.hD(2);break;case 4:return t.return(c)}})},L1=function(z,p,c,B,H,T){p=g.M9(p,c);
B=Object.assign({},T,{priority:B,retryScheduleIntervalsInSeconds:H});return{actionType:z,entityKey:p,actionMetadata:B}},dZ=function(z,p,c,B,H,T){this.status=z;
this.W=p;this.X=c;this.K=B;this.D=H;this.downloadState=T},xVJ=function(z,p,c){this.W=z;
this.Wq=p;this.D=c},JSz=function(z,p){var c,B,H,T,b,D,t,X,x;
return g.L(function(E){switch(E.W){case 1:return c=p.entityKey,H=(B=g.I(p.actionMetadata,W0))==null?void 0:B.isEnqueuedForExpiredStreamUrlRefetch,g.Ox(E,2),T=void 0,g.a(E,Evg(z,p),4);case 4:T=E.K;g.Ox(E,5);var q=(q=g.I(p.actionMetadata,W0))?{maximumDownloadQuality:q.maximumDownloadQuality}:void 0;return g.a(E,DVd(c,z.Wq,{isEnqueuedForExpiredStreamUrlRefetch:H,E6:q,offlineSourceData:T}),7);case 7:b=E.K;g.RE(E,6,2);break;case 5:return g.SQ(E,2),D=V6(p)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",c0("PDE handleAdd error"),E.return(y6(p,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",D,"DOWNLOAD_STATE_FAILED"));case 6:return g.a(E,qrQ(z,b,p),8);case 8:return E.return(y6(p,!0,b.orchestrationActions));case 2:return t=g.SQ(E),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.wy&&t.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),c0("PDE handleAdd error"),E.return(y6(p,!1,void 0,X,x,"DOWNLOAD_STATE_FAILED"))}})},mV1=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW;
return g.L(function(f){switch(f.W){case 1:return c=p.entityKey,B=g.Jz(c).entityId,g.a(f,s1(z.W,{mode:"readonly",xt:!0},function(F){var N=jm(F,c,"playbackData"),h=jm(F,g.M9(B,"offlineVideoPolicy"),"offlineVideoPolicy");F=jm(F,g.M9(B,"transfer"),"transfer");return g.Zg.all([N,h,F])}),2);
case 2:H=f.K;T=g.m(H);b=T.next().value;D=T.next().value;t=T.next().value;X=b;x=D;E=t;if(!X||!x)return f.return(y6(p,!0));q=[];P=((M=X)==null?0:M.playerResponseJson)?JSON.parse(X.playerResponseJson):null;if(!(E&&P&&z.Wq.Y("html5_refresh_deprecated_downloads"))){f.hD(3);break}J=MV3(z,P,E);return g.a(f,Yrz(z,E),4);case 4:q=f.K;case 3:O={lastPlayerResponseTimestampSeconds:X.playerResponseTimestamp,offlineToken:x.offlineToken,formatIds:q};R={};if((K=E)==null?0:K.maximumDownloadQuality)R.maximumDownloadQuality=
E.maximumDownloadQuality;g.Ox(f,5);Z=void 0;return g.a(f,Evg(z,p),7);case 7:return Z=f.K,g.Ox(f,8),g.a(f,DVd(c,z.Wq,{refreshData:O,E6:R,offlineSourceData:Z,mediaCapabilities:J}),10);case 10:W=f.K;g.RE(f,9,5);break;case 8:return g.SQ(f,5),v=V6(p)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",c0("PDE handleRefresh error"),f.return(y6(p,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",v,"DOWNLOAD_STATE_FAILED"));
case 9:return g.a(f,qrQ(z,W,p),11);case 11:return f.return(y6(p,!0,W.orchestrationActions));case 5:return zY=g.SQ(f),U="PDE handleRefresh error",zY instanceof Error&&(U="PDE handleRefresh error: "+zY.message),HD="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",VW="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",zY instanceof g.wy&&zY.type==="QUOTA_EXCEEDED"&&(HD="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",VW="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),c0(U),f.return(y6(p,
!1,void 0,HD,VW,"DOWNLOAD_STATE_FAILED"))}})},Evg=function(z,p){var c,B,H,T;
return g.L(function(b){if(b.W==1)return c=g.Jz(p.entityKey).entityId,B=g.M9(c,"videoDownloadContextEntity"),g.a(b,gx(z.W,B,"videoDownloadContextEntity"),2);H=b.K;return(T=H)!=null&&T.offlineModeType?b.return({offlineModeType:H.offlineModeType}):b.return(void 0)})},qrQ=function(z,p,c){var B,H,T,b,D;
return g.L(function(t){if(t.W==1){if(!p.frameworkUpdates||!g.I(p.frameworkUpdates,Of))return t.return();if(!(g.I(p.frameworkUpdates,Of).mutations&&g.I(p.frameworkUpdates,Of).mutations.length>0&&g.I(p.frameworkUpdates,Of).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return t.hD(2);B=g.Jz(g.I(p.frameworkUpdates,Of).mutations[0].entityKey).entityId;return g.a(t,wZ(z.W,B),3)}if(t.W!=2){H=t.K;T=g.I(c.actionMetadata,W0);if(D=(b=T)==null?void 0:b.playlistId)H.playlistId=D;H.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.cX(z.Wq)?g.a(t,AK(B,z.W,c,z.D,H),2):g.rn(z.Wq)?g.a(t,RT(B,z.W,c,z.D),2):t.hD(2)}return g.a(t,omK(g.I(p.frameworkUpdates,Of)),0)})},y6=function(z,p,c,B,H,T){return new dZ(p?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V6(z),c,B,H,T)},MV3=function(z,p,c){p=SYQ(z.Wq,c.cotn,p);
c=g.qk(p);return g.IWV(p,c,z.Wq)},Yrz=function(z,p){var c,B,H,T,b,D,t,X,x,E,q;
return g.L(function(J){if(J.W==1)return c=[],g.a(J,s1(z.W,{mode:"readonly",xt:!0},function(M){var P=[],O=p.offlineVideoStreams;if(O){O=g.m(O);for(var R=O.next();!R.done;R=O.next())P.push(jm(M,R.value,"offlineVideoStreams"))}return g.Zg.all(P)}),2);
if(B=J.K)for(H=g.m(B),T=H.next();!T.done;T=H.next())if(b=T.value,D=void 0,(D=b)==null?0:D.streamsProgress)for(t=b.streamsProgress,X=0;X<t.length;X++)x=t[X],E=JSON.parse(x.formatStreamBytes),q={itag:E.itag,lmt:E.lastModified,xtags:E.xtags},c.push(q);return J.return(c)})},hR$=function(z,p){this.W=z;
this.Wq=p},P8Q=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J;
return g.L(function(M){switch(M.W){case 1:return c=V6(p),g.a(M,GA(z.W,"videoPlaybackPositionEntity"),2);case 2:B=M.K;if(B.length===0)return M.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Ox(M,3);return g.a(M,lw.getInstance(),5);case 5:H=M.K;if(!H)throw Error("prefStorage is undefined");return g.a(M,H.get("psi"),6);case 6:return T=M.K,t=(D=(b=T)==null?void 0:b.DG)!=null?D:"0",g.a(M,bo3(B,t),7);case 7:return X=M.K,x={isPaused:X.watchHistoryPaused,DG:X.syncTimestampUsec},g.a(M,H.set("psi",
x),8);case 8:if(x.isPaused){M.hD(9);break}E=g.I(X.frameworkUpdates,Of);if(!X.frameworkUpdates||!E){M.hD(9);break}return g.a(M,omK(E),9);case 9:g.RE(M,4);break;case 3:return q=g.SQ(M),J="PPE handleRefresh error: "+(q instanceof Error?q.message:"unknown error"),c0(J),M.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},Oog=function(z,p){var c,B,H,T,b,D,t,X;
return g.L(function(x){switch(x.W){case 1:return c=V6(p),B=g.Jz(p.entityKey).entityId,g.Ox(x,2),g.a(x,lw.getInstance(),4);case 4:H=x.K;if(!H)throw Error("prefStorage is undefined");return g.a(x,H.get("psi"),5);case 5:T=x.K;b=g.I(p.actionMetadata,ASE);if(((D=T)==null?void 0:D.isPaused)!==!1||(t=b)==null||!t.lastPlaybackPositionSeconds){x.hD(6);break}X={key:g.M9(B,"videoPlaybackPositionEntity"),videoId:B,lastPlaybackPositionSeconds:b.lastPlaybackPositionSeconds};return g.a(x,ks(z.W,X,"videoPlaybackPositionEntity"),
6);case 6:g.RE(x,3);break;case 2:return g.SQ(x),x.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},wOq=function(z,p){var c,B,H;
return g.L(function(T){switch(T.W){case 1:c=V6(p);g.Ox(T,2);B=g.Jz(p.entityKey).entityId;if(B==="!*$_ALL_ENTITIES_!*$")return g.a(T,lRg(z.W),5);H=g.M9(B,"videoPlaybackPositionEntity");return g.a(T,e99(z.W,H),5);case 5:g.RE(T,3);break;case 2:return g.SQ(T),T.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},RRz=function(z,p){this.api=z;
this.W=p;this.logger=new g.Xk("woffle");this.K=!1;this.Xg={Sx:this.Sx};this.logger.debug("Initialized OfflineMediaManager")},Sr1=function(z){return g.L(function(p){return p.return(gmL(z))})},$VK=function(z){var p;
return g.L(function(c){if(c.W==1)return g.a(c,g.XrE(z),2);p=c.K;return c.return(p.filter(function(B){return!!B.url}).map(function(B){return B.url}))})},C1=function(z,p){var c=g.C8(p);
if(c===1||c===0)return Promise.resolve();(c=KG9(z,p))&&c.stopVideo();z.D=0;return Sr1(p)},e6=function(z,p,c,B){c=c===void 0?!1:c;
B=B===void 0?!0:B;var H=typeof p==="string"?p:p.videoDetails.videoId;g.C8(H)===2&&((p=KG9(z,H))?p.stopVideo():z.logger.info(function(){return"Corresponding player for "+H+" not found. Pausing anyway"}),g.eO(H,2),z.D=2,c?udq(z.W):B&&aqL(z.W))},KG9=function(z,p){var c;
return((c=z.player)==null?void 0:c.getVideoData().videoId)===p?z.player:null},Zo3=function(z,p,c){p.getPlayerResponse();
g.eO(p.videoId,2);z.D=2;z.K=!1;var B;(B=z.player)==null||B.dispose();z.player=z.api.o4(p);p={};z.player.pn((p.localmediachange=z.Bv,p.signatureexpired=z.XZ,p.statechange=z.NUp,p),z);var H=z.Sx(c);z.player.sy(g.tP(H,H,!0,"m"),!1);z.logger.debug(function(){return"Starting headless playback with quality: "+H});
z.player.VU(!1)},LGm=function(z,p){this.W=z;
this.Wq=p},WGJ=function(z,p){var c,B;
return g.L(function(H){switch(H.W){case 1:return c=V6(p),g.a(H,gx(z.W,p.entityKey,"transfer"),2);case 2:if(B=H.K)return H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Ox(H,3);return g.a(H,dV1(z,p),5);case 5:g.RE(H,4);break;case 3:return g.SQ(H),H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},yS3=function(z,p){var c,B;
return g.L(function(H){switch(H.W){case 1:return c=V6(p),g.a(H,gx(z.W,p.entityKey,"transfer"),2);case 2:B=H.K;if(!B||B.transferState!=="TRANSFER_STATE_COMPLETE")return H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Ox(H,3);return g.a(H,dV1(z,p,!0),5);case 5:g.RE(H,4);break;case 3:return g.SQ(H),H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},C8v=function(z,p){var c,B,H,T,b,D,t,X,x,E;
return g.L(function(q){switch(q.W){case 1:return c=V6(p),B=g.Jz(p.entityKey).entityId,g.a(q,s1(z.W,{mode:"readonly",xt:!0},function(J){var M=jm(J,p.entityKey,"transfer");J=jm(J,g.M9(B,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Zg.all([M,J])}),2);
case 2:H=q.K;T=g.m(H);b=T.next().value;D=T.next().value;t=b;X=D;if(!t||t.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return q.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Ox(q,3);t.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.a(q,ks(z.W,t,"transfer"),5);case 5:x=g.Jz(t.key).entityId;b7({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:x,Ls:t,offlineModeType:(E=X)==null?void 0:E.offlineModeType});g.RE(q,
4);break;case 3:return g.SQ(q),q.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return q.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},dV1=function(z,p,c){c=c===void 0?!1:c;
var B,H,T,b,D,t,X,x,E,q,J,M,P,O,R;return g.L(function(K){switch(K.W){case 1:return B=g.I(p.actionMetadata,eRq),H=g.Jz(p.entityKey).entityId,T=g.M9(H,"downloadStatusEntity"),g.a(K,s1(z.W,{mode:"readonly",xt:!0},function(Z){var W=jm(Z,T,"downloadStatusEntity");Z=jm(Z,g.M9(H,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Zg.all([W,Z])}),2);
case 2:return b=K.K,D=g.m(b),t=D.next().value,X=D.next().value,x=t,E=X,q="TRANSFER_STATE_TRANSFER_IN_QUEUE",((J=x)==null?void 0:J.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(q="TRANSFER_STATE_PAUSED_BY_USER"),O={key:p.entityKey,transferState:q,cotn:g.Zu(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(M=B)==null?void 0:M.maximumDownloadQuality,preferredAudioTrack:(P=B)==null?void 0:P.preferredAudioTrack,transferRetryCount:0,isRefresh:c,hasLoggedFirstStarted:!1},g.a(K,s1(z.W,
{mode:"readwrite",xt:!0},function(Z){var W=[];c&&W.push(Q4(Z,g.M9(H,"offlineVideoStreams")));W.push(ns(Z,O,"transfer"));return g.Zg.all(W)}),3);
case 3:if(!c){K.hD(4);break}return g.a(K,Sr1(H),4);case 4:b7({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:H,Ls:O,offlineModeType:(R=E)==null?void 0:R.offlineModeType}),g.Ai(K)}})},vvJ=function(z,p,c,B){if(!z.action.entityKey)throw Error("entityKey is missing.");
var H=g.Jz(z.action.entityKey);H={entityType:H.tV,entityId:H.entityId,offlineOrchestrationActionType:z.action.actionType,orchestrationAction:{orchestrationActionId:z.actionId}};p&&(H.offlineOrchestrationActionResult=p.status,H.isRetryable=c?!1:p.W,p.D&&(H.offlineOrchestrationFailureReason=lq9(p.D,H.isRetryable)));var T,b;if((T=z.action.actionMetadata)==null?0:(b=T.offlineLoggingData)==null?0:b.offlineModeType)H.offlineModeType=z.action.actionMetadata.offlineLoggingData.offlineModeType;B&&(H.additionalOrchestrationActions=
B.map(function(D){return{orchestrationActionId:D.actionId}}));
return H},lq9=function(z,p){return z!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||p?z==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&p?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":z:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},Iq$=function(z,p){var c={offlineOrchestrationContext:vvJ(z)};
p=BKg(p,c);Hxz(cEz(),p,z.rootActionId)},jA1=function(z,p,c,B){B=B===void 0?[]:B;
p={offlineOrchestrationContext:vvJ(z,p,c,B)};p=BKg(3,p);Hxz(cEz(),p,z.rootActionId)},FGE=function(){this.actions=[]},ov9=function(z,p){p=g.m(p);
for(var c=p.next();!c.done;c=p.next())c=c.value,Iq$(c,1),z.actions.push(c);z.actions.sort(z.W)},nvL=function(z,p){if(p)for(var c=0;c<z.actions.length;c++)if(p==="!*$_ALL_ENTITIES_!*$"&&z.actions[c].actionId!==p||p!=="!*$_ALL_ENTITIES_!*$"&&z.actions[c].rootActionId===p&&z.actions[c].actionId!==p)z.actions.splice(c,1),c--},QAl=function(z,p){z=g.m(z.actions);
for(var c=z.next();!c.done;c=z.next())if(c.value.actionId===p)return!0;return!1},l7=function(z,p,c,B,H){g.e.call(this);
var T=this;this.K=z;this.tD=p;this.MZ=c;this.G=B;this.Wq=H;this.W=new FGE;this.V=new g.pU;this.D=new g.B4(function(){T.retry()});
this.S=NaN;this.L=!1;this.Xg={wep:function(){return T.W},
Xi:function(){return T.V},
Jza:function(){return T.D},
retry:function(){return T.retry()}};
g.l(this,this.D);this.U=this.K.observe(this.Dt.bind(this))},sAm=function(z,p,c,B,H){var T;
return g.L(function(b){if(b.W==1)return T=new l7(z,p,c,B,H),g.a(b,rS3(T),2);UVg(T);return b.return(T)})},UVg=function(z){var p=z.W.actions[0];
return z.X?((p==null?void 0:p.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&z.X[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(z.L=!0),Promise.resolve()):k_J(z)},k_J=function(z){var p,c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R;
return g.L(function(K){switch(K.W){case 1:if(z.X)throw Error("Already processing an action");if(z.qZ())return K.return();p=z.W.actions.shift();YYz(z.MZ,!p);if(p===void 0)return K.return();p.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&p.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&nvL(z.W,p.actionId);c="";p.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&p.rootActionId===p.actionId&&(c=p.actionId);B=[p];z.X=B;if(H=z.tD[p.entityType]){K.hD(2);break}z.X=
void 0;return g.a(K,k_J(z),3);case 3:return K.return();case 2:T=g.m(B);for(b=T.next();!b.done;b=T.next())D=b.value,Iq$(D,2);g.Ox(K,4,5);return g.a(K,XOv(H,B.map(function(Z){return Z.action})),7);
case 7:t=K.K,X=g.m(B),x=X.next();case 8:if(x.done){K.hD(10);break}E=x.value;q=t.get(E.action);return g.a(K,gvQ(z,E,q),9);case 9:x=X.next();K.hD(8);break;case 10:nvL(z.W,c);case 5:g.$B(K);z.X=void 0;g.K_(K,6);break;case 4:return J=g.SQ(K),c0("Orchestration error",J),g.Ox(K,12),g.a(K,G_z(z,B),14);case 14:g.RE(K,5);break;case 12:M=g.SQ(K);c0("Orchestration retry error",M);P=g.m(B);for(O=P.next();!O.done;O=P.next())R=O.value,R.retryScheduleIndex<3&&ov9(z.W,[R]);K.hD(5);break;case 6:return g.a(K,k_J(z),
0)}})},gvQ=function(z,p,c){var B,H,T,b,D,t,X,x,E,q,J,M;
return g.L(function(P){switch(P.W){case 1:B=p.retryScheduleIndex+2===3;if(c.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){P.hD(2);break}if(c.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){P.hD(0);break}jA1(p,c,B);if(c.W&&p.retryScheduleIndex+1<3)return g.a(P,G_z(z,[p]),0);T=((H=c)==null?0:H.K)?c.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";b={entityKey:p.action.entityKey,failureReason:T};D=void 0;g.cX(z.Wq)?D="mainVideoDownloadStateEntity":g.rn(z.Wq)&&(D="musicTrackDownloadMetadataEntity");
if(!D||!c.downloadState){P.hD(7);break}t=g.Jz(p.action.entityKey).entityId;return g.a(P,xz(t,D,z.K,c.downloadState),7);case 7:H0(z.G,b);if(c.downloadState==="DOWNLOAD_STATE_FAILED"&&z.Wq.Y("html5_auto_retry_failed_pde_actions")){P.hD(0);break}c0("Orchestration result is not retryable, deleting action");return g.a(P,e99(z.K,m3(p).key),0);case 2:X=void 0;try{X=(x=c.X)==null?void 0:x.map(function(O){return z.createAction(O,p)})}catch(O){return jA1(p,c,B),E={entityKey:p.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},H0(z.G,E),c0("Orchestration subactions creation error",O),P.return()}jA1(p,c,B,X);if(!X){P.hD(12);break}q=X.map(function(O){return m3(O)});
J=0;case 13:if(!(J<X.length)||z.L){P.hD(15);break}return g.a(P,s1(z.K,{mode:"readwrite",xt:!0},function(O){var R=[];R.push($y1(O,q.slice(J,J+10),"offlineOrchestrationActionWrapperEntity"));return g.Zg.all(R)}),16);
case 16:J+=10;P.hD(13);break;case 15:if(z.L)return z.L=!1,P.return();case 12:return M=m3(p),g.a(P,e99(z.K,M.key),17);case 17:Iq$(p,4),g.Ai(P)}})},p4J=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J;
return g.L(function(M){c=[];B=Infinity;H=4E3;T=g.m(p);for(b=T.next();!b.done;b=T.next())D=b.value,t=Number(D.enqueueTimeSec),X=N43(t),x=D.retryScheduleIndex,E=x!=null&&x>0,X>0&&E?(B=Math.min(B,t),H=Math.min(X,H)):c.push(D);isFinite(B)&&(!z.D.isActive()||B<z.S)&&(z.S=B,z.D.start(H));z.V.Bn()||(q=c.length,c=c.filter(function(P){var O;P=((O=P.actionProto)==null?void 0:O.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!fqQ.includes(P)}),J=c.length<q,!z.D.isActive()&&J&&z.D.start(1));
c.length>0&&z_9(z,c);return g.a(M,UVg(z),0)})},BD$=function(z){var p,c,B,H,T,b,D;
return g.L(function(t){if(t.W==1)return g.a(t,cnL(z),2);p=t.K;c=[];B=g.m(p);for(H=B.next();!H.done;H=B.next())T=H.value,b=g.Jz(T.key),D=b.entityId,QAl(z.W,D)||c.push(T);return g.a(t,p4J(z,c),0)})},N43=function(z){z=z*1E3-Date.now();
return z>4E3?4E3:z},G_z=function(z,p){var c,B,H;
return g.L(function(T){c=g.m(p);for(B=c.next();!B.done;B=c.next()){H=B.value;var b=void 0,D=void 0,t=((D=H.action)==null?void 0:(b=D.actionMetadata)==null?void 0:b.retryScheduleIntervalsInSeconds)||[1,2,4];b=1;H.retryScheduleIndex<t.length&&(b=t[H.retryScheduleIndex]);H.W=b*1E3+Date.now();H.retryScheduleIndex++}return g.a(T,HI1(z,p),0)})},rS3=function(z){var p;
return g.L(function(c){if(c.W==1)return g.a(c,GA(z.K,"offlineOrchestrationActionWrapperEntity"),2);p=c.K;return g.a(c,p4J(z,p),0)})},z_9=function(z,p){p.length!==0&&p.forEach(function(c){c=Yz(c);
c.retryScheduleIndex<3&&ov9(z.W,[c])})},cnL=function(z,p){var c;
return g.L(function(B){if(B.W==1)return g.a(B,GA(z.K,"offlineOrchestrationActionWrapperEntity",p),2);c=B.K;return B.return(c.filter(nm3))})},HI1=function(z,p){if(p.length===0)return Promise.resolve([]);
p=p.map(function(c){return m3(c)});
return Cnd(z.K,p)},iI9=function(z){this.nH=z;
this.W=void 0},TDm=function(z,p){var c,B,H,T;
return g.L(function(b){c=p.videoId;B=!0;if(p.captionTracks.length)H=ODE(p),z.W=new g.hV(z.nH,p,H);else if(p.dJ)T=g.PqY(p),z.W=new g.AV(z.nH,p.dJ,c,T,p.i_,p.eventId),B=p.i_;else return b.return();return b.return(new Promise(function(D){var t;(t=z.W)==null||t.FR({ym:function(){return g.L(function(X){if(X.W==1)return g.a(X,z.ym(c,B),2);D();g.Ai(X)})},
t6:function(){}})}))})},bIl=function(z){var p;
return g.L(function(c){if(c.W==1)return g.a(c,kXq(z),2);p=c.K;return c.return(!!p&&p.length>0)})},v0=function(z){g.e.call(this);
this.W=z;this.K=this.W.observe(this.D.bind(this))},Vo1=function(z,p){var c,B,H,T,b,D,t;
return g.L(function(X){switch(X.W){case 1:if(p.length===0)return X.return([]);c=p.map(function(x){return g.M9(x,"transfer")});
return g.a(X,GA(z.W,"transfer",c),2);case 2:B=X.K;H=B.filter(nm3).map(function(x){return g.Jz(x.key).entityId});
T=p.filter(function(x){return H.indexOf(x)===-1});
if(T.length===0)return X.return([]);b=g.m(T);D=b.next();case 3:if(D.done){X.hD(5);break}t=D.value;return g.a(X,Sr1(t),4);case 4:D=b.next();X.hD(3);break;case 5:return X.return(T)}})},X4q=function(z,p,c,B,H,T){var b,D,t;
return g.L(function(X){b="STREAM_TYPE_UNKNOWN";c.video&&c.audio?(b="STREAM_TYPE_AUDIO_AND_VIDEO",c0("unexpected stream type")):c.video&&!c.audio?b="STREAM_TYPE_VIDEO":!c.video&&c.audio&&(b="STREAM_TYPE_AUDIO");D=g.M9(p,"offlineVideoStreams");t={numBytesDownloaded:H.toFixed(),numTotalBytes:T.toFixed(),streamType:b,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(B),itag:b==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(c.itag):void 0};return g.a(X,s1(z,{mode:"readwrite",xt:!0},
function(x){var E=jm(x,D,"offlineVideoStreams"),q=jm(x,g.M9(p,"transfer"),"transfer");return g.Zg.all([E,q]).then(function(J){J=g.m(J);var M=J.next().value;J=J.next().value;if(!J)return Q4(x,D).then(function(){});
var P=D5l(M);M=toq(M,B,t,D);var O=ns(x,M,"offlineVideoStreams");D5l(M)>P&&(J.lastProgressTimeMs=Date.now().toString());P=[O];J.offlineVideoStreams||(J.offlineVideoStreams=[]);J.offlineVideoStreams.indexOf(D)===-1&&(J.offlineVideoStreams.push(D),P.push(ns(x,J,"transfer")));return g.Zg.all(P)})}),0)})},x5z=function(z,p){var c,B,H,T,b;
return g.L(function(D){if(D.W==1)return c=g.M9(p,"offlineVideoStreams"),g.a(D,gx(z,c,"offlineVideoStreams"),2);B=D.K;if(!B||!B.streamsProgress)return D.return();H=g.m(B.streamsProgress);for(T=H.next();!T.done;T=H.next())b=T.value,b.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",b.numTotalBytes!==b.numBytesDownloaded&&(b.numBytesDownloaded=b.numTotalBytes);return g.a(D,ks(z,B,"offlineVideoStreams"),0)})},toq=function(z,p,c,B){if(z&&z.streamsProgress){B=z;
a:{p=p.itag+";"+p.xtags;for(var H=z.streamsProgress,T=0;T<H.length;T++){var b=JSON.parse(H[T].formatStreamBytes);if(b.itag+";"+b.xtags===p){H[T]=c;c=H;break a}}H.push(c);c=H}B.streamsProgress=c}else z={key:B,streamsProgress:[c]};return z},D5l=function(z){if(z==null?0:z.streamsProgress){var p=0;
z=z.streamsProgress;for(var c=0;c<z.length;c++){var B=z[c];isNaN(Number(B.numBytesDownloaded))?c0("stream progress bytes number invalid"):p+=Number(B.numBytesDownloaded)}return p}return 0},EfQ=function(z,p,c,B){g.e.call(this);
var H=this;this.K=z;this.api=p;this.i8=c;this.Dt=B;this.V=new g.pU;this.X=new g.B4(function(){H.W&&H.W.transferState==="TRANSFER_STATE_TRANSFERRING"&&H.V.Bn()&&((H.W.transferRetryCount||0)<3?e6(H.G,H.L,!1,!1):C1(H.G,H.L.videoDetails.videoId),H.Jh("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.MZ=this.Ra=0;this.U=this.S=!1;this.OH=g.P3(this.api.N().experiments,"html5_transfer_processing_logs_interval");this.rA=new g.or(this);this.Xg={lY3:function(){return H.X},
xwA:function(){return H.Dt},
Xi:function(){return H.V}};
this.tD=this.K.observe(this.GA.bind(this));this.G=new RRz(p,this);this.NZ=new iI9(p);this.T$=new v0(this.K);this.fH=this.V.listen("publicytnetworkstatus-online",this.gf.bind(this));this.YA=this.V.listen("publicytnetworkstatus-offline",this.QI0.bind(this));this.U=this.api.N().Y("html5_less_transfer_processing_logs");g.l(this,this.rA);this.rA.Z(p,"offlinetransferpause",this.jII);g.cX(this.api.N())?this.D="mainVideoDownloadStateEntity":g.rn(this.api.N())&&(this.D="musicTrackDownloadMetadataEntity")},
qoL=function(z){return g.L(function(p){if(p.W==1)p=g.a(p,Uyv(),2);
else{var c=z.T$;var B=g.yv();B=Object.keys(B);c=Vo1(c,B);p=g.a(p,c,0)}return p})},j6=function(z,p){p=p===void 0?!1:p;
var c;return g.L(function(B){if(B.W==1){if(z.W)throw Error("Already downloading a video");z.MZ=0;z.S=!1;return g.a(B,Jn1(z),2)}return B.W!=4?(c=B.K,m3Q(z.i8,!c),c&&z.V.Bn()?p?g.a(B,new Promise(function(H){g.O0(H,1E3)}),4):B.hD(4):(!c&&z.W&&IT(z),B.hD(0))):g.a(B,MoK(z,c),0)})},Yog=function(z){return g.L(function(p){if(p.W==1)return z.L?g.a(p,C1(z.G,z.L.videoDetails.videoId),3):p.hD(0);
IT(z);g.Ai(p)})},m5$=function(z,p){var c,B,H;
return g.L(function(T){switch(T.W){case 1:return g.Ox(T,2),(c=!!p.captionTracks.length||!!p.dJ)?g.a(T,bIl(p.videoId),4):T.return();case 4:return(B=T.K)?T.return():g.a(T,TDm(z.NZ,p),5);case 5:g.RE(T,0);break;case 2:H=g.SQ(T),c0("Caption downloading error",H,p.cotn),g.Ai(T)}})},MoK=function(z,p){var c,B,H,T,b,D;
return g.L(function(t){switch(t.W){case 1:if(z.S)return t.return();z.S=!0;z.W=p;c=g.Jz(z.W.key);B=c.entityId;H=void 0;if(z.W.transferState==="TRANSFER_STATE_TRANSFERRING")return g.a(t,Fv(z,B),7);if(z.W.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||z.W.transferRetryCount||z.W.hasLoggedFirstStarted){t.hD(3);break}return g.a(t,Fv(z,B),5);case 5:return H=t.K,z.W.hasLoggedFirstStarted=!0,g.a(t,h_E(z),6);case 6:hT1({videoId:B,Ls:z.W,offlineModeType:H},void 0,void 0,!0);t.hD(3);break;case 7:H=t.K,
b7({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:B,Ls:z.W,offlineModeType:H});case 3:return g.a(t,P5E(z),8);case 8:return T=null,g.Ox(t,9),g.a(t,An$(z,p),11);case 11:T=t.K;z.L=T;g.RE(t,10);break;case 9:return b=g.SQ(t),c0("error getting player response",b,p.cotn),g.a(t,z.Jh("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return t.return();case 10:return D=SYQ(z.api.N(),p.cotn,T),g.a(t,m5$(z,D),13);case 13:return g.a(t,$VK(D.videoId),
14);case 14:D.mP=t.K,Zo3(z.G,D,p.maximumDownloadQuality),z.X.start(108E5),g.Ai(t)}})},Jn1=function(z){var p,c;
return g.L(function(B){if(B.W==1)return g.a(B,GA(z.K,"transfer"),2);p=B.K;c=p.filter(OI$).sort(w4z);return c.length===0?B.return():B.return(c[0])})},P5E=function(z){var p,c,B;
return g.L(function(H){if(H.W==1){if(!z.W)return oT(z,"onTransferStart"),H.return();z.X.start(108E5);return g.a(H,n1(z,"TRANSFER_STATE_TRANSFERRING"),2)}p=z.W;return(B=((c=p)==null?0:c.key)?g.Jz(p.key).entityId:"")&&z.D?g.a(H,xz(B,z.D,z.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):H.hD(0)})},udq=function(z){var p,c,B,H;
g.L(function(T){switch(T.W){case 1:if(!z.W){oT(z,"onTransferPausedByUser");T.hD(2);break}p=z.W;z.X.stop();return g.a(T,n1(z,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:B=((c=p)==null?0:c.key)?g.Jz(p.key).entityId:"";if(!B||!z.D){T.hD(4);break}return g.a(T,xz(B,z.D,z.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.a(T,Fv(z,B),6);case 6:H=T.K,P61({videoId:B,Ls:p,offlineModeType:H});case 2:IT(z),j6(z),g.Ai(T)}})},aqL=function(z){var p,c,B;
g.L(function(H){if(H.W==1){if(!z.W)return oT(z,"onTransferPausedByNetwork"),H.return();z.X.stop();return g.a(H,n1(z,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(H.W!=3)return p=z.W,(B=((c=p)==null?0:c.key)?g.Jz(p.key).entityId:"")&&z.D?g.a(H,xz(B,z.D,z.K,"DOWNLOAD_STATE_PAUSED"),3):H.hD(3);IT(z);g.Ai(H)})},R_K=function(z){var p,c,B,H,T;
g.L(function(b){switch(b.W){case 1:if(!z.W)return oT(z,"onTransferComplete"),b.return();p=z.W;z.X.stop();if(!p||!z.L){b.hD(2);break}c=SYQ(z.api.N(),p.cotn,z.L);return g.a(b,m5$(z,c),2);case 2:return g.a(b,n1(z,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:H=((B=p)==null?0:B.key)?g.Jz(p.key).entityId:"";if(!H||!z.D){b.hD(5);break}return g.a(b,xz(H,z.D,z.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.a(b,x5z(z.K,H),7);case 7:return g.a(b,Fv(z,H),8);case 8:T=b.K,b7({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:H,Ls:p,offlineModeType:T}),IT(z),j6(z),g.Ai(b)}})},So1=function(z,p,c){var B,H;
g.L(function(T){switch(T.W){case 1:if(!z.W)return oT(z,"onTransferProgress: "+p),T.return();if(z.W.transferState==="TRANSFER_STATE_TRANSFERRING"){T.hD(2);break}return g.a(T,P5E(z),2);case 2:B=Date.now();if(!(B-z.Ra>1E3)){T.hD(4);break}z.Ra=B;return g.a(T,X4q(z.K,c.videoId,c.K,c.py,c.bytesDownloaded,c.W),5);case 5:if(z.U&&!(z.U&&B-z.MZ>z.OH)){T.hD(4);break}z.MZ=B;return g.a(T,Fv(z,p),7);case 7:H=T.K,hT1({videoId:p,Ls:z.W,offlineModeType:H},c.bytesDownloaded,c.W);case 4:z.X.start(108E5),g.Ai(T)}})},
$5z=function(z){var p=(z.W.transferRetryCount||0)<3;
p&&(z=z.W,z.transferRetryCount=(z.transferRetryCount||0)+1);return p},KaL=function(z,p){p=p===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":p;
var c,B,H,T;return g.L(function(b){if(b.W==1)return z.W||oT(z,"setTransferToFailed: "+p),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p==="TRANSFER_FAILURE_REASON_NETWORK"?c="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":p==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.a(b,n1(z,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",p),2);if(b.W!=3)return H0(z.Dt,{entityKey:(B=z.W)==null?void 0:B.key,failureReason:c}),
H=z.W?g.Jz(z.W.key).entityId:"",g.a(b,Fv(z,H),3);T=b.K;var D={videoId:H,Ls:z.W,offlineModeType:T},t=p,X={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};t&&(X.transferFailureReason=t,X.failureReason=AEd(t));b7(X,D);g.Ai(b)})},n1=function(z,p,c,B){var H;
return g.L(function(T){if(T.W==1){if(!z.W)return oT(z,"saveTransferState: "+p),T.return();z.W.transferState=p;z.W.failureReason=B;g.Ox(T,2);return g.a(T,h_E(z,function(b){return c?Ft(b,"offlineVideoStreams",z.W.offlineVideoStreams).then(function(D){for(var t=g.m(D),X=t.next();!X.done;X=t.next())if((X=X.value)&&X.streamsProgress){X=g.m(X.streamsProgress);for(var x=X.next();!x.done;x=X.next())x.value.streamState=c}return $y1(b,D.filter(function(E){return!!E}),"offlineVideoStreams")}):g.Zg.resolve(void 0)}),
4)}if(T.W!=2)return g.RE(T,0);
H=g.SQ(T);return H instanceof g.wy&&H.type==="QUOTA_EXCEEDED"?g.a(T,z.Jh("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):T.hD(0)})},h_E=function(z,p){var c;
return g.L(function(B){if(!z.W)return B.return();c=z.W;return g.a(B,s1(z.K,{mode:"readwrite",xt:!0},function(H){var T=[ns(H,c,"transfer")];p&&T.push(p(H));return g.Zg.all(T)}),0)})},IT=function(z){z.W=void 0;
z.L=void 0;z.X.stop()},An$=function(z,p){var c,B,H,T,b;
return g.L(function(D){if(D.W==1)return c=g.Jz(p.key),B=c.entityId,H=g.M9(B,"playbackData"),g.a(D,gx(z.K,H,"playbackData"),2);T=D.K;if((b=T)==null?0:b.playerResponseJson)return D.return(JSON.parse(T.playerResponseJson));throw Error("No PlayerResponse found");})},oT=function(z,p){z.api.KH("woffle",{mcte:p});
c0("missing current transfer entity.")},Fv=function(z,p){var c,B,H;
return g.L(function(T){if(T.W==1)return g.a(T,gx(z.K,g.M9(p,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);c=T.K;return T.return((H=(B=c)==null?void 0:B.offlineModeType)!=null?H:void 0)})},OI$=function(z){return ujE[z.transferState]!==void 0},w4z=function(z,p){var c=ujE[z.transferState],B=ujE[p.transferState];
return c!==B?c-B:Number(z.enqueuedTimestampMs)-Number(p.enqueuedTimestampMs)},Q6=function(z,p){var c=this;
this.Wq=z;this.api=p;this.V=new g.pU;this.L=new g.OE;this.Xg={zX:function(){return c.D.Xg.zX()},
Xi:function(){return c.V},
oO8:function(){return c.D},
Jp:function(){return c.Jp()},
T4:function(){return c.T4()},
vR:function(){return c.vR()},
n0:function(){return c.n0()},
u0:function(){return c.u0()},
vY:function(B){return c.vY(B)}};
this.D=new qY1(function(){return avq(c)},function(){c.vR()},this.api.wC(),this.api.Y.bind(this.api));
this.W=new B0(this.api);JEv(this.D)},avq=function(z){return g.L(function(p){z.api.AD("onOrchestrationBecameLeader");
return g.a(p,z.T4(),0)})},LaE=function(z){var p,c;
return g.L(function(B){if(B.W==1)return g.a(B,NX(),2);if(B.W!=3){p=B.K;if(!p)return c0("PES is undefined"),B.return();z.K=new EfQ(p,z.api,z.D,z.W);c=z.TM(p);return g.a(B,sAm(p,c,z.D,z.W,z.Wq),3)}z.G=B.K;return g.a(B,ZIq(z),0)})},ZIq=function(z){var p;
return g.L(function(c){switch(c.W){case 1:if(!z.K)return c0("transferManager is undefined"),c.return();if(z.K.W){c.hD(2);break}return g.a(c,j6(z.K),2);case 2:if(!z.Wq.Y("woffle_enable_main_downloads_library")){c.hD(4);break}return g.a(c,z.Vu(),4);case 4:if(!z.Wq.Y("html5_offline_playback_position_sync")){c.hD(6);break}return g.a(c,z.nf(),7);case 7:return g.a(c,z.vY(864E5),6);case 6:return g.a(c,z.refreshAllStaleEntities(43200,!0),9);case 9:return g.a(c,z.xZ(),10);case 10:if(!z.Wq.Y("html5_retry_downloads_for_expiration")){c.hD(11);
break}return g.a(c,z.u0(),11);case 11:return z.S=g.wS(function(){z.refreshAllStaleEntities(43200,!0);z.xZ()},9E5),g.iR(g.bR(),function(){return z.n0()}),g.a(c,NX(),13);
case 13:return p=c.K,g.a(c,EO3(p),14);case 14:Mug(z.D),g.Ai(c)}})},d5Q=function(){var z,p,c,B,H,T;
return g.L(function(b){switch(b.W){case 1:return g.a(b,NX(),2);case 2:z=b.K;if(!z)return b.return([]);p=Date.now()/1E3;return g.a(b,GA(z,"offlineVideoPolicy"),3);case 3:c=b.K,B=g.m(c),H=B.next();case 4:if(H.done){b.hD(6);break}T=H.value;if(!(T.expirationTimestamp&&Number(T.expirationTimestamp)<p)){b.hD(5);break}T.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";T.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.a(b,ks(z,T,"offlineVideoPolicy"),5);
case 5:H=B.next();b.hD(4);break;case 6:return b.return(c.map(function(D){return D.key}))}})},rZ=function(z,p,c,B,H){var T,b,D;
return g.L(function(t){if(t.W==1)return g.a(t,NX(),2);T=t.K;if(!T)return t.return([]);b=p.map(function(X){var x=g.M9(X,c);x={actionType:B,entityKey:x,actionMetadata:Object.assign({},$3E(),H)};B!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(x.actionMetadata.priority=0);X=new Mf(c,X,x);return m3(X)});
D=Cnd(T,b);JEv(z.D);return t.return(D)})},WaQ=function(z,p,c,B){var H,T,b,D,t,X,x,E;
return g.L(function(q){switch(q.W){case 1:H=[],T=g.m(p),b=T.next();case 2:if(b.done){q.hD(4);break}D=b.value;if(D.upToDate||c&&!D.shouldAutoSyncMetadata||!D.playlistId){q.hD(3);break}t={};switch(B){case "mainPlaylistEntity":X={nextAutoRefreshIntervalSeconds:D.checkInSeconds,autoSync:c};t={mainPlaylistEntityActionMetadata:X};break;case "musicPlaylist":x={autoSync:c},t={musicPlaylistEntityActionMetadata:x}}return g.a(q,rZ(z,[D.playlistId],B,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t),6);case 6:(E=
q.K)&&H.push.apply(H,g.A(E));case 3:b=T.next();q.hD(2);break;case 4:return q.return(H)}})},ynz=function(z,p){var c;
return g.L(function(B){return p.length?(c=$3E(),g.sF(c,W0,{isEnqueuedForExpiredStreamUrlRefetch:!0}),z.api.KH("qrd",{v:p.length}),B.return(rZ(z,p,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c))):B.return([])})},C5z=function(z,p,c){this.W=z;
this.Wq=p;this.D=c},vf9=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K;
return g.L(function(Z){switch(Z.W){case 1:return c=V6(p),B=g.Jz(p.entityKey),H=B.entityId,T=[],g.Ox(Z,2),g.a(Z,e_Q(z,H),4);case 4:T=Z.K;if(!(z.Wq.Y("woffle_enable_main_downloads_library")&&((b=T)==null?0:b.length))){Z.hD(5);break}return g.a(Z,ILd(z.W,[p.entityKey]),5);case 5:g.RE(Z,3);break;case 2:return D=g.SQ(Z),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.wy&&D.type==="QUOTA_EXCEEDED"?(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):c0("Playlist add error"),Z.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,t,X));case 3:x=[];if(!z.Wq.Y("html5_offline_prevent_redownload_downloaded_video")){Z.hD(7);break}return g.a(Z,RT3(z.W,"mainVideoEntity",T),8);case 8:T=Z.K;case 7:if((E=T)==null?0:E.length)for(q=g.m(T),J=q.next();!J.done;J=q.next())if(M=J.value,P=M.offlineVideoData,O=void 0,(O=P)==null?0:O.videoId)R=void 0,K=Number(((R=p.actionMetadata)==null?void 0:R.priority)||
0)+1,x.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P.videoId,"mainVideoEntity",K,Uf,lvQ(p,P,H)));return Z.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,x))}})},jYm=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md,uf,zv,bE,m1,w,S,u,d,C,p_,TY,bf,y,xB,mS,ti,du,YL,jl,Jy,Ux,Fe,t5,C2,rC,E2,rc,oW,UN,ON,qQ,ZC,JD,Lf,jL,FW,$X,zu,sN,i0,Zq,Qs;
return g.L(function(MC){switch(MC.W){case 1:return c=V6(p),B=p.entityKey,H=g.Jz(B).entityId,T=[],b=!1,H==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.a(MC,GA(z.W,"mainPlaylistEntity"),5)):g.a(MC,gx(z.W,B,"mainPlaylistEntity"),4);case 4:(D=MC.K)&&T.push(D);MC.hD(3);break;case 5:T=MC.K;case 3:if((t=T)==null||!t.length)return MC.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));X=g.I(p.actionMetadata,Iv3);E=(x=X)==null?void 0:x.nextAutoRefreshIntervalSeconds;J=(q=X)==null?void 0:q.autoSync;M=[];O=P=
!0;R=!1;if(!b&&J===!1){MC.hD(6);break}g.Ox(MC,7);return g.a(MC,zRL(0,!!J,!0,T),9);case 9:M=MC.K;g.RE(MC,8);break;case 7:K=g.SQ(MC);if(!(K instanceof Error&&K.message==="No data")){K instanceof Error&&K.message==="Empty response body"&&c0(K.message);MC.hD(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.a(MC,Wk9(z.W,p,z.D,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.a(MC,Lkg(H,z.W,p,z.D),8);case 8:if(!M.length||!b&&M[0].playlistId!==H)return MC.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));case 6:if(b){Z=[];W=g.m(M);for(v=W.next();!v.done;v=W.next())zY=v.value,zY.upToDate||J&&!zY.shouldAutoSyncMetadata||!zY.playlistId||(U={nextAutoRefreshIntervalSeconds:zY.checkInSeconds,autoSync:J},Z.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",zY.playlistId,"mainPlaylistEntity",0,Uf,{mainPlaylistEntityActionMetadata:U})));return MC.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,Z))}M.length&&(HD=M[0],R=!!HD.upToDate,J&&(P=(VW=HD.shouldAutoSyncMetadata)!=null?VW:!0,O=(f=HD.shouldAutoSyncVideos)!=
null?f:!0,HD.checkInSeconds&&(E=HD.checkInSeconds)));if(R||!P)return MC.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));F=[];N=T[0];if(!N.downloadState){h=void 0;MC.hD(15);break}return g.a(MC,gx(z.W,N.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:h=MC.K;case 15:return n=h,Rg=((FY=n)==null?0:FY.addedTimestampMillis)?String(n.addedTimestampMillis):void 0,g.Ox(MC,17),g.a(MC,e_Q(z,H,Rg,E),19);case 19:F=MC.K;g.RE(MC,18);break;case 17:Md=g.SQ(MC);if(!(Md instanceof Error&&
Md.message==="No data for playlist")){if(Md instanceof Error&&Md.message==="Empty response body for playlist")c0(Md.message);else return uf="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",zv="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Md instanceof g.wy&&Md.type==="QUOTA_EXCEEDED"&&(uf="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",zv="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),MC.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,uf,zv));MC.hD(18);
break}return g.a(MC,Lkg(H,z.W,p,z.D),18);case 18:if(!O)return MC.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));bE=[];m1=new Map;if((w=F)==null?0:w.length)for(S=g.m(F),u=S.next();!u.done;u=S.next())d=u.value,C=d.offlineVideoData,p_=void 0,((p_=C)==null?0:p_.videoId)&&m1.set(C.videoId,C);TY=new Map;bf=[];if((y=N)==null?0:(xB=y.videos)==null?0:xB.length)for(mS=g.m(N.videos),ti=mS.next();!ti.done;ti=mS.next())if(du=ti.value,YL=JSON.parse(g.Jz(du).entityId),jl=YL.videoId)m1.has(jl)?(TY.set(jl,
m1.get(jl)),m1.delete(jl)):bf.push(jl);Ux=Number(((Jy=p.actionMetadata)==null?void 0:Jy.priority)||0)+1;Fe=g.m(m1.entries());for(t5=Fe.next();!t5.done;t5=Fe.next())C2=t5.value,rC=g.m(C2),E2=rC.next().value,rc=rC.next().value,oW=E2,UN=rc,bE.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",oW,"mainVideoEntity",Ux,Uf,lvQ(p,UN,H)));ON=g.m(TY.entries());for(qQ=ON.next();!qQ.done;qQ=ON.next())ZC=qQ.value,JD=g.m(ZC),Lf=JD.next().value,jL=JD.next().value,FW=Lf,$X=jL,bE.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
FW,"mainVideoEntity",Ux,Uf,lvQ(p,$X,H)));zu=g.m(bf);for(sN=zu.next();!sN.done;sN=zu.next())i0=sN.value,Zq={playlistId:H},Qs={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Zq},bE.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",i0,"mainVideoEntity",0,Uf,Qs));return MC.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,bE))}})},FaK=function(z,p){var c,B,H,T;
return g.L(function(b){switch(b.W){case 1:return c=V6(p),g.Ox(b,2),B=g.Jz(p.entityKey).entityId,B==="!*$_ALL_ENTITIES_!*$"?g.a(b,Wk9(z.W,p,z.D,(H=p.actionMetadata)==null?void 0:(T=H.offlineLoggingData)==null?void 0:T.offlineDeleteReason),5):g.a(b,Lkg(B,z.W,p,z.D),6);case 6:if(!z.Wq.Y("woffle_enable_main_downloads_library")){b.hD(5);break}return g.a(b,jVm(z.W,p.entityKey),5);case 5:g.RE(b,3);break;case 2:return g.SQ(b),b.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},e_Q=function(z,p,c,B){var H,T,b,D,t,X,x;
return g.L(function(E){switch(E.W){case 1:return g.a(E,NKE([p]),2);case 2:return H=E.K,g.a(E,of1(z,H[0],c,B),3);case 3:return T=E.K,b=T.mainPlaylistEntity,D=T.LV3,X=aL1(b,(t=D)==null?void 0:t.avatar),g.Ox(E,4),g.a(E,P0(X),6);case 6:g.RE(E,5);break;case 4:x=g.SQ(E),x instanceof Error&&x.message==="Failed to fetch"&&c0(x.message);case 5:return E.return(H[0].videos)}})},of1=function(z,p,c,B){var H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W;
return g.L(function(v){switch(v.W){case 1:H=Date.now().toString();c||(c=H);T=p.videos;b=p.playlistId;D=[];t=[];if(T)for(X=g.m(T),x=X.next();!x.done;x=X.next()){E=x.value;q=E.offlineVideoData;if(!q||!q.videoId)throw c0("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");J=q.videoId;M={videoId:J,playlistId:b};P={id:g.M9(JSON.stringify(M),"mainPlaylistVideoEntity"),video:g.M9(J,"mainVideoEntity")};D.push(P);t.push(P.id)}R={key:g.M9(b,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:c,lastSyncedTimestampMillis:H};K={key:g.M9(b,"mainPlaylistEntity"),playlistId:b,videos:t,title:p.title,thumbnailStyleData:nfE(p),visibility:QYK(p),downloadState:R.key};p.channel&&(Z=p.channel.offlineChannelData,O=rnQ(g.M9(b,"ytMainChannelEntity"),Z),K.channelOwner=O.id);((W=K)==null?0:W.entityMetadata)?(K.entityMetadata.offlineLastModifiedTimestampSeconds=p.lastModifiedTimestamp,B&&(K.entityMetadata.nextAutoRefreshIntervalSeconds=String(B))):K&&(K.entityMetadata={nextAutoRefreshIntervalSeconds:B?
String(B):void 0,offlineLastModifiedTimestampSeconds:p.lastModifiedTimestamp});g.Ox(v,2);return g.a(v,s1(z.W,{mode:"readwrite",xt:!0},function(zY){var U=ns(zY,K,"mainPlaylistEntity"),HD=ns(zY,R,"mainPlaylistDownloadStateEntity");U=[U,HD];HD=g.m(D);for(var VW=HD.next();!VW.done;VW=HD.next())U.push(ns(zY,VW.value,"mainPlaylistVideoEntity"));O&&U.push(ns(zY,O,"ytMainChannelEntity"));return g.Zg.all(U)}),4);
case 4:g.RE(v,3);break;case 2:throw g.SQ(v),c0("PES failure for playlist"),Error("PES failure for playlist");case 3:return v.return({mainPlaylistEntity:K,LV3:O,A48:D})}})},rnQ=function(z,p){return{id:z,
channelId:p.channelId,title:p.title,avatar:p.thumbnail}},nfE=function(z){var p=[],c=z.videos;
c&&c.length>0&&p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:c[0].offlineVideoData.thumbnail}}});if((z=z.additionalMetadadatas)&&z.length>0)for(z=g.m(z),c=z.next();!c.done;c=z.next()){var B=c.value.offlineBundleItemPlaylistData,H=void 0;c=(H=B)==null?void 0:H.style;H=void 0;B={collageThumbnail:{coverThumbnail:(H=B)==null?void 0:H.coverThumbnail}};switch(c){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:B});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:B});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:B});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:B})}}return p},QYK=function(z){switch(z.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},lvQ=function(z,p,c){p={offlineVideoData:p,
playlistId:c};if(z=g.I(z.actionMetadata,Iv3))p.maximumDownloadQuality=z.maximumDownloadQuality;return{mainVideoEntityActionMetadata:p}},U5q=function(z,p,c){this.W=z;
this.Wq=p;this.D=c},gfq=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M;
return g.L(function(P){switch(P.W){case 1:return c=V6(p),B=g.Jz(p.entityKey),H=B.entityId,T=g.I(p.actionMetadata,sf),D=!((b=T)==null?0:b.playlistId),g.Ox(P,2),g.a(P,sYl(z,H,void 0,(t=T)==null?void 0:t.offlineVideoData,D),4);case 4:g.RE(P,3);break;case 2:return X=g.SQ(P),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.wy&&X.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
P.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,x,E));case 3:q=1;q=Number(((J=p.actionMetadata)==null?void 0:J.priority)||0)+1;var O=(O=g.I(p.actionMetadata,sf))?{playbackDataActionMetadata:{maximumDownloadQuality:O.maximumDownloadQuality}}:void 0;M=L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",q,kV3,O);return P.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,[M]))}})},GVd=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K;
return g.L(function(Z){switch(Z.W){case 1:return c=V6(p),B=g.Jz(p.entityKey),H=B.entityId,g.a(Z,gx(z.W,p.entityKey,"mainVideoEntity"),2);case 2:T=Z.K;if(!T){b=void 0;Z.hD(3);break}return g.a(Z,gx(z.W,T.downloadState,"mainVideoDownloadStateEntity"),4);case 4:b=Z.K;case 3:D=b;if(!T||!D)return Z.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Ox(Z,5);return g.a(Z,sYl(z,H,D.addedTimestampMillis,(X=g.I(p.actionMetadata,sf))==null?void 0:X.offlineVideoData),7);case 7:x=1;x=Number(((E=
p.actionMetadata)==null?void 0:E.priority)||0)+1;t=L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",x,kV3);g.RE(Z,6);break;case 5:q=g.SQ(Z);if(!(q instanceof Error&&q.message==="No data")){if(q instanceof Error&&q.message==="Empty response body")c0(q.message);else return J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.wy&&q.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,J,M));Z.hD(6);break}return g.a(Z,wZ(z.W,H),9);case 9:P=Z.K;O=g.I(p.actionMetadata,sf);if(K=(R=O)==null?void 0:R.playlistId)P.playlistId=K;P.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.a(Z,AK(H,z.W,p,z.D,P),6);case 6:return Z.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,t?[t]:void 0))}})},ND1=function(z,p){var c,B,H,T,b,D,t,X,x,E;
return g.L(function(q){switch(q.W){case 1:return c=V6(p),g.Ox(q,2),B=g.Jz(p.entityKey).entityId,B==="!*$_ALL_ENTITIES_!*$"?g.a(q,Wk9(z.W,p,z.D,(x=p.actionMetadata)==null?void 0:(E=x.offlineLoggingData)==null?void 0:E.offlineDeleteReason),5):g.a(q,wZ(z.W,B),6);case 6:H=q.K;T=g.I(p.actionMetadata,sf);if(D=(b=T)==null?void 0:b.playlistId)H.playlistId=D;H.offlineDeleteReason=(t=p.actionMetadata)==null?void 0:(X=t.offlineLoggingData)==null?void 0:X.offlineDeleteReason;return g.a(q,AK(B,z.W,p,z.D,H),7);
case 7:if(!z.Wq.Y("woffle_enable_main_downloads_library")){q.hD(5);break}return g.a(q,jVm(z.W,p.entityKey),5);case 5:g.RE(q,3);break;case 2:return g.SQ(q),q.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},sYl=function(z,p,c,B,H){var T,b,D,t,X,x;
return g.L(function(E){switch(E.W){case 1:if(T=B){E.hD(2);break}return g.a(E,Gwl([p]),3);case 3:b=E.K,T=b[0];case 2:return g.a(E,fvJ(z,T,c,H),4);case 4:D=E.K;t=D.mainVideoEntity;X=D.channelEntity;g.Ox(E,5);var q=JK(t.thumbnail),J=JK(X.avatar);return g.a(E,P0(q.concat(J)),7);case 7:g.RE(E,0);break;case 5:x=g.SQ(E),x instanceof Error&&x.message==="Failed to fetch"&&c0(x.message),g.Ai(E)}})},fvJ=function(z,p,c,B){var H,T,b,D,t,X,x,E,q,J,M,P,O;
return g.L(function(R){switch(R.W){case 1:c||(c=Date.now().toString());T=(H=p.channel)==null?void 0:H.offlineChannelData;b={id:g.M9(p.videoId,"ytMainChannelEntity"),channelId:T.channelId,title:T.title,avatar:T.thumbnail};D={key:g.M9(p.videoId,"mainVideoDownloadStateEntity"),playbackData:g.M9(p.videoId,"playbackData"),addedTimestampMillis:c,videoDownloadContextEntity:g.M9(p.videoId,"videoDownloadContextEntity")};t={key:g.M9(p.videoId,"videoPlaybackPositionEntity"),videoId:p.videoId,lastPlaybackPositionSeconds:"0"};
z.Wq.Y("html5_offline_playback_position_sync")&&(X={playbackPosition:t.key});x=g.M9(p.videoId,"mainVideoEntity");E={key:x,videoId:p.videoId,title:p.title,thumbnail:p.thumbnail,localizedStrings:{viewCount:p.shortViewCountText},userState:X,lengthSeconds:p.lengthSeconds?Number(p.lengthSeconds):void 0,publishedTimestampMillis:p.publishedTimestamp?(Number(p.publishedTimestamp)*1E3).toString():void 0,formattedDescription:p.description,owner:b.id,downloadState:D.key};if(!z.Wq.Y("woffle_enable_main_downloads_library")||
!B){R.hD(2);break}return g.a(R,vOL(z.W,[x]),3);case 3:if(M=R.K)q=M.mainDownloadsLibraryEntity,J=M.mainDownloadsListEntity;case 2:return O=wVq,P={key:g.M9(p.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.sF(D,O,P),g.a(R,s1(z.W,{mode:"readwrite",xt:!0},function(K){var Z=ns(K,b,"ytMainChannelEntity"),W=ns(K,D,"mainVideoDownloadStateEntity"),v=ns(K,E,"mainVideoEntity");Z=[Z,W,v];z.Wq.Y("html5_offline_playback_position_sync")&&(W=ns(K,t,"videoPlaybackPositionEntity"),
Z.push(W));q&&(W=ns(K,q,"mainDownloadsLibraryEntity"),Z.push(W));J&&(W=ns(K,J,"mainDownloadsListEntity"),Z.push(W));P&&(K=ns(K,P,"downloadStatusEntity"),Z.push(K));return g.Zg.all(Z)}),4);
case 4:return R.return({mainVideoEntity:E,channelEntity:b})}})},z4Q=function(z,p,c){this.W=z;
this.Wq=p;this.D=c},cqE=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N;
return g.L(function(h){switch(h.W){case 1:return c=V6(p),B=[],g.a(h,lw.getInstance(),2);case 2:H=h.K;if(!H){h.hD(3);break}return g.a(h,H.get("sdois"),4);case 4:return T=h.K,g.a(h,(D=H)==null?void 0:D.get("lmqf"),5);case 5:b=h.K;case 3:g.Ox(h,6);if(T===void 0)throw Error("prefStorage or opt-in state is undefined");t=[];if(T){h.hD(8);break}return g.a(h,lL3(z.W),9);case 9:t=h.K,t.reverse();case 8:if(!t.length){h.hD(10);break}X=g.m(t);x=X.next();case 11:if(x.done){h.hD(10);break}E=x.value;if(!E){h.hD(12);
break}q=g.Jz(E).entityId;return g.a(h,wZ(z.W,q),14);case 14:return J=h.K,J.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.a(h,AK(q,z.W,{entityKey:E,actionType:p.actionType},z.D,J),12);case 12:x=X.next();h.hD(11);break;case 10:return g.a(h,cSL(T,(M=b)!=null?M:"SD"),16);case 16:return P=h.K,g.a(h,yEL(P),17);case 17:O=eT3(P);if(!z.Wq.Y("woffle_enable_main_downloads_library")){h.hD(18);break}if(T){h.hD(19);break}return g.a(h,jVm(z.W,g.ZE),19);case 19:return g.a(h,ILd(z.W,[g.ZE]),18);
case 18:if((R=O)==null?0:R.length)for(K=g.m(O),Z=K.next();!Z.done;Z=K.next())if(v=W=Z.value,zY=v.actionType,U=v.entityKey,HD=v.actionMetadata,zY&&U&&HD&&!g.I(HD,pnE)){zY==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(HD.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(VW=g.I(W.actionMetadata,sf))VW.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",W.actionMetadata=Object.assign({},W.actionMetadata,{mainVideoEntityActionMetadata:VW});B.push(W)}g.RE(h,7);break;
case 6:return f=g.SQ(h),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.wy&&f.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),h.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,F,N));case 7:return h.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,B))}})},Bjl=function(){Q6.apply(this,arguments);
this.U="mainVideoEntity"},HQQ=function(z,p,c){p=p===void 0?43200:p;
c=c===void 0?!0:c;var B=B===void 0?!1:B;var H,T,b;return g.L(function(D){switch(D.W){case 1:if(!z.V.Bn())return D.return([]);H=[];g.Ox(D,2);return g.a(D,zRL(p,c,B),4);case 4:H=D.K;g.RE(D,3);break;case 2:T=g.SQ(D),T instanceof Error&&T.message==="No data"||T instanceof Error&&T.message==="Empty response body"&&c0(T.message);case 3:return b=WaQ(z,H,c,"mainPlaylistEntity"),D.return(b)}})},iQL=function(z,p,c,B){B=B===void 0?!1:B;
var H,T,b,D,t,X,x,E,q,J,M,P,O,R,K;return g.L(function(Z){switch(Z.W){case 1:return H=[],g.a(Z,pOd(),2);case 2:return(T=Z.K)||B?g.a(Z,B4l(p,c),3):Z.return([]);case 3:b=Z.K;if((D=b)==null||!D.length)return Z.return([]);t={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};X=g.m(b);x=X.next();case 4:if(x.done){Z.hD(6);break}q=E=x.value;J=q.actionType;M=q.entityKey;P=q.actionMetadata;if(!(J&&M&&P)||g.I(P,pnE)){Z.hD(5);break}J==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(P.offlineLoggingData=
t);O=g.Jz(M);R=O.entityId;return g.a(Z,rZ(z,[R],"mainVideoEntity",J,P),8);case 8:K=Z.K,H=H.concat(K);case 5:x=X.next();Z.hD(4);break;case 6:return Z.return(H)}})},Tjg=function(z,p){this.W=z;
this.D=p},VYE=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R;
return g.L(function(K){switch(K.W){case 1:return c=V6(p),B=g.Jz(p.entityKey),H=B.entityId,T=[],g.Ox(K,2),g.a(K,bQd(z,H),4);case 4:T=K.K;if((b=T)==null||!b.length){K.hD(5);break}return g.a(K,rE1(z.W,p.entityKey),5);case 5:g.RE(K,3);break;case 2:return D=g.SQ(K),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.wy&&D.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,t,X));case 3:return x=[],g.a(K,RT3(z.W,"musicTrack",T),7);case 7:T=K.K;if(T.length)for(E=g.m(T),q=E.next();!q.done;q=E.next())if(J=q.value,M=J.offlineVideoData,P=void 0,(P=M)==null?0:P.videoId)O=void 0,R=Number(((O=p.actionMetadata)==null?void 0:O.priority)||0)+1,x.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"musicTrack",R,kz,K1(p,M,H)));return K.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,x))}})},
DRq=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md,uf,zv,bE,m1,w,S,u,d,C,p_,TY,bf,y,xB,mS,ti,du,YL,jl,Jy,Ux,Fe,t5,C2,rC,E2,rc;
return g.L(function(oW){switch(oW.W){case 1:return c=V6(p),B=p.entityKey,H=g.Jz(B).entityId,T=[],b=!1,H==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.a(oW,GA(z.W,"musicAlbumRelease"),5)):g.a(oW,gx(z.W,B,"musicAlbumRelease"),4);case 4:(D=oW.K)&&T.push(D);oW.hD(3);break;case 5:T=oW.K;case 3:if((t=T)==null||!t.length)return oW.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));if(b){X=[];x=g.m(T);for(E=x.next();!E.done;E=x.next())q=E.value,J=g.Jz(q.id).entityId,X.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
J,"musicAlbumRelease",0,kz));return oW.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,X))}M=[];P=T[0];O=void 0;if(!P.downloadMetadata){oW.hD(6);break}return g.a(oW,gx(z.W,P.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:R=oW.K,O=Number((Z=(K=R)==null?void 0:K.addedTimestampMillis)!=null?Z:"0")/1E3;case 6:return g.Ox(oW,8),g.a(oW,bQd(z,H,(W=O)==null?void 0:W.toString()),10);case 10:M=oW.K;g.RE(oW,9);break;case 8:v=g.SQ(oW);if(!(v instanceof Error&&v.message===
"No data")){if(v instanceof Error&&v.message==="Empty response body")c0(v.message);else return zY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.wy&&v.type==="QUOTA_EXCEEDED"&&(zY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),oW.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,zY,U));oW.hD(9);break}return g.a(oW,S6(H,"musicAlbumRelease",
z.W,p,z.D),9);case 9:HD=[];VW=new Map;if((f=M)==null?0:f.length)for(F=g.m(M),N=F.next();!N.done;N=F.next())h=N.value,n=h.offlineVideoData,FY=void 0,((FY=n)==null?0:FY.videoId)&&VW.set(n.videoId,n);Rg=new Map;Md=[];if((uf=P)==null?0:(zv=uf.tracks)==null?0:zv.length)for(bE=g.m(P.tracks),m1=bE.next();!m1.done;m1=bE.next())if(w=m1.value,S=g.Jz(w).entityId)VW.has(S)?(Rg.set(S,VW.get(S)),VW.delete(S)):Md.push(S);d=Number(((u=p.actionMetadata)==null?void 0:u.priority)||0)+1;C=g.m(VW.entries());for(p_=C.next();!p_.done;p_=
C.next())TY=p_.value,bf=g.m(TY),y=bf.next().value,xB=bf.next().value,mS=y,ti=xB,HD.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",mS,"musicTrack",d,kz,K1(p,ti)));du=g.m(Rg.entries());for(YL=du.next();!YL.done;YL=du.next())jl=YL.value,Jy=g.m(jl),Ux=Jy.next().value,Fe=Jy.next().value,t5=Ux,C2=Fe,HD.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t5,"musicTrack",d,kz,K1(p,C2)));rC=g.m(Md);for(E2=rC.next();!E2.done;E2=rC.next())rc=E2.value,HD.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",rc,
"musicTrack",0,kz));return oW.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,HD))}})},tYJ=function(z,p){var c,B;
return g.L(function(H){switch(H.W){case 1:return c=V6(p),g.Ox(H,2),B=g.Jz(p.entityKey).entityId,B==="!*$_ALL_ENTITIES_!*$"?g.a(H,$z(z.W,p,z.D),5):g.a(H,S6(B,"musicAlbumRelease",z.W,p,z.D),6);case 6:return g.a(H,U39(z.W,p.entityKey),5);case 5:g.RE(H,3);break;case 2:return g.SQ(H),H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},bQd=function(z,p,c){var B,H,T;
return g.L(function(b){switch(b.W){case 1:return g.a(b,NKE([p]),2);case 2:return B=b.K,g.a(b,Xng(z,B[0],c),3);case 3:return H=b.K,T=JK(H.thumbnailDetails),g.a(b,P0(T),4);case 4:return b.return(B[0].videos)}})},Xng=function(z,p,c){var B,H,T,b,D,t,X,x,E,q,J,M,P,O;
return g.L(function(R){if(R.W==1){B=p.additionalMetadadatas;H=void 0;if(B&&B.length>0)for(T=g.m(B),b=T.next();!b.done;b=T.next())if(D=b.value,D.offlineMusicPlaylistData){H=D.offlineMusicPlaylistData;break}t=p.playlistId;X=sVq(p);x=X.qh;E=X.Lr;q=c?(Number(c)*1E3).toString():Date.now().toString();J=p.lastModifiedTimestamp?(Number(p.lastModifiedTimestamp)*1E3).toString():"0";M={id:g.M9(t,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:E,lastModifiedTimestampMillis:J,addedTimestampMillis:q,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};P={id:g.M9(t,"musicAlbumRelease"),title:p.title,audioPlaylistId:t,trackCount:p.totalVideoCount,tracks:x,downloadMetadata:M.id};H&&(P.thumbnailDetails=(O=H.albumHqThumbnail)!=null?O:H.albumArtistThumbnail,P.artistDisplayName=H.albumArtistDisplayName,P.releaseDate=H.albumReleaseDate,P.contentRating={explicitType:H.albumReleaseExplicitType},P.releaseType=H.albumReleaseType);return g.a(R,s1(z.W,{mode:"readwrite",xt:!0},function(K){var Z=ns(K,P,"musicAlbumRelease");
K=ns(K,M,"musicAlbumReleaseDownloadMetadataEntity");return g.Zg.all([Z,K])}),2)}return R.return(P)})},xR1=function(z,p){this.W=z;
this.D=p},q6E=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R;
return g.L(function(K){switch(K.W){case 1:return c=V6(p),B=g.Jz(p.entityKey),H=B.entityId,T=[],g.Ox(K,2),g.a(K,ED$(z,H),4);case 4:T=K.K;if((b=T)==null||!b.length){K.hD(5);break}return g.a(K,rE1(z.W,p.entityKey),5);case 5:g.RE(K,3);break;case 2:return D=g.SQ(K),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.wy&&D.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,t,X));case 3:return x=[],g.a(K,RT3(z.W,"musicTrack",T),7);case 7:T=K.K;if(T.length)for(E=g.m(T),q=E.next();!q.done;q=E.next())if(J=q.value,M=J.offlineVideoData,P=void 0,(P=M)==null?0:P.videoId)O=void 0,R=Number(((O=p.actionMetadata)==null?void 0:O.priority)||0)+1,x.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"musicTrack",R,gZ,K1(p,M,H)));return K.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,x))}})},
Jqq=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md,uf,zv,bE,m1,w,S,u,d,C,p_,TY,bf,y,xB,mS,ti,du,YL,jl,Jy,Ux,Fe,t5,C2,rC,E2,rc,oW,UN,ON,qQ,ZC,JD,Lf,jL,FW,$X,zu,sN;
return g.L(function(i0){switch(i0.W){case 1:return c=V6(p),B=p.entityKey,H=g.Jz(B).entityId,T=[],b=!1,H==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.a(i0,GA(z.W,"musicPlaylist"),5)):g.a(i0,gx(z.W,B,"musicPlaylist"),4);case 4:(D=i0.K)&&T.push(D);i0.hD(3);break;case 5:T=i0.K;case 3:if((t=T)==null||!t.length)return i0.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));X=g.I(p.actionMetadata,kwQ);E=(x=X)==null?void 0:x.autoSync;q=[];M=J=!0;P=!1;O=void 0;if(!b&&E===!1){i0.hD(6);break}g.Ox(i0,7);return g.a(i0,
Ho1(0,!!E,!0,T),9);case 9:q=i0.K;g.RE(i0,8);break;case 7:R=g.SQ(i0);if(!(R instanceof Error&&R.message==="No data")){R instanceof Error&&R.message==="Empty response body"&&c0(R.message);i0.hD(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.a(i0,$z(z.W,p,z.D),8):g.a(i0,S6(H,"musicPlaylist",z.W,p,z.D),8);case 8:if(!q.length||!b&&q[0].playlistId!==H)return i0.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));case 6:if(b){K=[];Z=g.m(q);for(W=Z.next();!W.done;W=Z.next())v=W.value,v.upToDate||
E&&!v.shouldAutoSyncMetadata||!v.playlistId||(zY={autoSync:E},K.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",v.playlistId,"musicPlaylist",0,gZ,{musicPlaylistEntityActionMetadata:zY})));return i0.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,K))}q.length&&(U=q[0],P=!!U.upToDate,E&&(J=(HD=U.shouldAutoSyncMetadata)!=null?HD:!0,M=(VW=U.shouldAutoSyncVideos)!=null?VW:!0,U.checkInSeconds&&(O=U.checkInSeconds)));if(P||!J)return i0.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));f=[];F=T[0];N=void 0;if(!F.downloadMetadata){i0.hD(15);break}return g.a(i0,gx(z.W,F.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:h=i0.K,N=Number((FY=(n=h)==null?void 0:n.addedTimestampMillis)!=null?FY:"0")/1E3;case 15:return g.Ox(i0,17),g.a(i0,ED$(z,H,(Rg=N)==null?void 0:Rg.toString(),O),19);case 19:f=i0.K;g.RE(i0,18);break;case 17:Md=g.SQ(i0);if(!(Md instanceof Error&&Md.message==="No data")){if(Md instanceof Error&&Md.message==="Empty response body")c0(Md.message);else return uf=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",zv="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Md instanceof g.wy&&Md.type==="QUOTA_EXCEEDED"&&(uf="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",zv="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),i0.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,uf,zv));i0.hD(18);break}return g.a(i0,S6(H,"musicPlaylist",z.W,p,z.D),18);case 18:if(!M)return i0.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));bE=[];m1=new Map;if((w=f)==null?0:w.length)for(S=g.m(f),u=S.next();!u.done;u=S.next())d=u.value,C=d.offlineVideoData,p_=void 0,((p_=C)==null?0:p_.videoId)&&m1.set(C.videoId,C);TY=new Map;bf=[];if((y=F)==null?0:(xB=y.tracks)==null?0:xB.length)for(mS=g.m(F.tracks),ti=mS.next();!ti.done;ti=mS.next())if(du=ti.value,YL=g.Jz(du).entityId)m1.has(YL)?(TY.set(YL,m1.get(YL)),m1.delete(YL)):bf.push(YL);Jy=Number(((jl=p.actionMetadata)==null?void 0:jl.priority)||0)+1;Ux=g.m(m1.entries());for(Fe=Ux.next();!Fe.done;Fe=
Ux.next())t5=Fe.value,C2=g.m(t5),rC=C2.next().value,E2=C2.next().value,rc=rC,oW=E2,bE.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",rc,"musicTrack",Jy,gZ,K1(p,oW)));UN=g.m(TY.entries());for(ON=UN.next();!ON.done;ON=UN.next())qQ=ON.value,ZC=g.m(qQ),JD=ZC.next().value,Lf=ZC.next().value,jL=JD,FW=Lf,bE.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",jL,"musicTrack",Jy,gZ,K1(p,FW)));$X=g.m(bf);for(zu=$X.next();!zu.done;zu=$X.next())sN=zu.value,bE.push(L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
sN,"musicTrack",0,gZ));return i0.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,bE))}})},MYK=function(z,p){var c,B;
return g.L(function(H){switch(H.W){case 1:return c=V6(p),g.Ox(H,2),B=g.Jz(p.entityKey).entityId,B==="!*$_ALL_ENTITIES_!*$"?g.a(H,$z(z.W,p,z.D),5):g.a(H,S6(B,"musicPlaylist",z.W,p,z.D),6);case 6:return g.a(H,U39(z.W,p.entityKey),5);case 5:g.RE(H,3);break;case 2:return g.SQ(H),H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},ED$=function(z,p,c,B){var H,T,b;
return g.L(function(D){switch(D.W){case 1:return g.a(D,NKE([p]),2);case 2:return H=D.K,g.a(D,Y6L(z,H[0],c,B),3);case 3:return T=D.K,b=JK(T.thumbnailDetails),g.a(D,P0(b),4);case 4:return D.return(H[0].videos)}})},Y6L=function(z,p,c,B){var H,T,b,D,t,X,x,E,q;
return g.L(function(J){return J.W==1?(H=p.playlistId,T=sVq(p),b=T.qh,D=T.Lr,t=c?(Number(c)*1E3).toString():Date.now().toString(),X=p.lastModifiedTimestamp?(Number(p.lastModifiedTimestamp)*1E3).toString():"0",x={id:g.M9(H,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:D,lastModifiedTimestampMillis:X,addedTimestampMillis:t,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},E={id:g.M9(H,"musicPlaylist"),title:p.title,playlistId:H,thumbnailDetails:p.thumbnail,visibility:mRz(p),trackCount:p.totalVideoCount,
tracks:b,downloadMetadata:x.id},B&&(((q=E)==null?0:q.entityMetadata)?E.entityMetadata.nextAutoRefreshIntervalSeconds=String(B):E&&(E.entityMetadata={nextAutoRefreshIntervalSeconds:String(B)})),g.a(J,s1(z.W,{mode:"readwrite",xt:!0},function(M){var P=ns(M,E,"musicPlaylist");M=ns(M,x,"musicPlaylistDownloadMetadataEntity");return g.Zg.all([P,M])}),2)):J.return(E)})},mRz=function(z){switch(z.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},h4$=function(z,p){this.W=z;
this.D=p},wnL=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M;
return g.L(function(P){switch(P.W){case 1:return c=V6(p),B=g.Jz(p.entityKey),H=B.entityId,T=g.I(p.actionMetadata,P3m),g.Ox(P,2),g.a(P,Aqm(z,H,void 0,(b=T)==null?void 0:b.track,(D=T)==null?void 0:D.albumRelease),4);case 4:if((t=T)==null?0:t.playlistId){P.hD(5);break}return g.a(P,rE1(z.W,p.entityKey),5);case 5:g.RE(P,3);break;case 2:return X=g.SQ(P),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.wy&&X.type==="QUOTA_EXCEEDED"&&
(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,x,E));case 3:J=Number(((q=p.actionMetadata)==null?void 0:q.priority)||0)+1;var O=(O=g.I(p.actionMetadata,P3m))?{playbackDataActionMetadata:{maximumDownloadQuality:O.maximumDownloadQuality}}:void 0;M=L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",J,OQg,O);return P.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c,[M]))}})},R4d=function(z,p){var c,B,H,T,b,D,t,X,x,E,q,J,M,P,O;
return g.L(function(R){switch(R.W){case 1:return c=V6(p),B=g.Jz(p.entityKey),H=B.entityId,g.a(R,gx(z.W,p.entityKey,"musicTrack"),2);case 2:T=R.K;if(!T){b=void 0;R.hD(3);break}return g.a(R,gx(z.W,T.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:b=R.K;case 3:D=b;if(!T||!D)return R.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));X=g.I(p.actionMetadata,P3m);g.Ox(R,5);return g.a(R,Aqm(z,H,D.addedTimestampMillis,(x=X)==null?void 0:x.track,(E=X)==null?void 0:E.albumRelease),
7);case 7:J=Number(((q=p.actionMetadata)==null?void 0:q.priority)||0)+1;t=L1("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",J,OQg);g.RE(R,6);break;case 5:M=g.SQ(R);if(!(M instanceof Error&&M.message==="No data")){if(M instanceof Error&&M.message==="Empty response body")c0(M.message);else return P="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.wy&&M.type==="QUOTA_EXCEEDED"&&(P="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,P,O));R.hD(6);break}return g.a(R,RT(H,z.W,p,z.D),6);case 6:return R.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,t?[t]:void 0))}})},S6l=function(z,p){var c,B;
return g.L(function(H){switch(H.W){case 1:return c=V6(p),g.Ox(H,2),B=g.Jz(p.entityKey).entityId,B==="!*$_ALL_ENTITIES_!*$"?g.a(H,$z(z.W,p,z.D),5):g.a(H,RT(B,z.W,p,z.D),6);case 6:return g.a(H,U39(z.W,p.entityKey),5);case 5:g.RE(H,3);break;case 2:return g.SQ(H),H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new dZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},Aqm=function(z,p,c,B,H){var T,b,D,t,X,x;
return g.L(function(E){switch(E.W){case 1:if(T=B){E.hD(2);break}return g.a(E,Gwl([p]),3);case 3:b=E.K,D=b[0],T=QV3(D);case 2:return g.a(E,$RJ(z,T,p,H,c),4);case 4:t=E.K;X=t.musicTrackEntity;x=t.KK;var q=JK(X.thumbnailDetails),J=[];x&&(J=JK(x.thumbnailDetails));return g.a(E,P0(q.concat(J)),0)}})},$RJ=function(z,p,c,B,H){var T;
return g.L(function(b){return b.W==1?(H||(H=Date.now().toString()),T={id:g.M9(c,"musicTrackDownloadMetadataEntity"),playbackData:g.M9(c,"playbackData"),addedTimestampMillis:H,videoDownloadContextEntity:g.M9(c,"videoDownloadContextEntity")},B&&(p.albumRelease=B.id),g.a(b,s1(z.W,{mode:"readwrite",xt:!0},function(D){var t=[],X=ns(D,T,"musicTrackDownloadMetadataEntity");t.push(X);X=ns(D,p,"musicTrack");t.push(X);B&&(D=ns(D,B,"musicAlbumRelease"),t.push(D));return g.Zg.all(t)}),2)):b.W!=3?g.a(b,xz(c,"musicTrackDownloadMetadataEntity",
z.W,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):b.return({musicTrackEntity:p,
KK:B})})},GR=function(){Q6.apply(this,arguments);
this.U="musicTrack"},K63=function(z,p,c){p=p===void 0?43200:p;
c=c===void 0?!0:c;var B=B===void 0?!1:B;var H,T;return g.L(function(b){switch(b.W){case 1:if(!z.V.Bn())return b.return([]);H=[];g.Ox(b,2);return g.a(b,Ho1(p,c,B),4);case 4:H=b.K;g.RE(b,3);break;case 2:g.SQ(b);case 3:return T=WaQ(z,H,c,"musicPlaylist"),b.return(T)}})},um9=function(){g.Ms.apply(this,arguments);
var z=this;this.events=new g.or(this);this.Wq=this.player.N();this.Xg={nOi:function(){return z.W},
Dm:function(){return z.Dm()},
IS:function(p){return z.IS(p)}}},a_$=function(z){var p;
z=g.I((p=z.getWatchNextResponse())==null?void 0:p.currentVideoEndpoint,g.ir);if(z==null?0:z.playlistId)var c=z.playlistId;return c},ZQ9=function(z,p){var c,B,H,T;
return g.L(function(b){if(b.W==1){c=p.clientPlaybackNonce;B={cpn:c,offlineSourceVisualElement:g.ZU(p.Ra||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};p.K&&(B.videoFmt=Number(p.K.itag));p.X&&(B.audioFmt=Number(p.X.itag));if((H=a_$(p))&&p.videoId){var D=p.videoId;D=H!=="PPSV"?Promise.resolve(!1):z.W.fp(D);b=g.a(b,D,3)}else b=b.hD(2);return b}b.W!=2&&(T=b.K)&&(B.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");z.K=c;g.MG("offlinePlaybackStarted",B);g.Ai(b)})};
g.Wv.prototype.o4=g.BD(51,function(z){return this.app.o4(z)});
g.qz.prototype.o4=g.BD(50,function(z){return g.zqx(this,9,z)});
g.Y(Cs,y4);g.DV.Object.defineProperties(Cs.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.W.entityMetadata},
set:function(z){this.W.entityMetadata=z}}});
g.Y(RPJ,Cs);RPJ.prototype.K=function(){return[]};
g.Y(SaK,Cs);SaK.prototype.K=function(){return[]};
g.Y($7d,Cs);$7d.prototype.K=function(){return[]};
g.Y(KMQ,Cs);KMQ.prototype.K=function(){return[]};
g.Y(uWz,Cs);uWz.prototype.K=function(){var z=[];this.W.alternateChannel&&z.push(this.W.alternateChannel);this.W.alternateChannelList&&z.push.apply(z,g.A(this.W.alternateChannelList));this.W.oneofChannelEntity&&z.push(this.W.oneofChannelEntity);return[].concat(g.A(new Set(z)))};
g.Y(aYE,Cs);aYE.prototype.K=function(){var z=[];this.W.entryCollection&&z.push(this.W.entryCollection);return[].concat(g.A(new Set(z)))};
g.Y(ZDK,y4);ZDK.prototype.K=function(){var z=[];this.W.video&&z.push(this.W.video);return[].concat(g.A(new Set(z)))};
g.Y(LMQ,Cs);LMQ.prototype.K=function(){var z=[];this.W.parentPlaylist&&z.push(this.W.parentPlaylist);if(this.W.entries)for(var p=g.m(this.W.entries),c=p.next();!c.done;c=p.next())z.push.apply(z,g.A((new ZDK(c.value)).K()));return[].concat(g.A(new Set(z)))};
g.Y(d7E,Cs);d7E.prototype.K=function(){var z=[];this.W.descriptionEntity&&z.push(this.W.descriptionEntity);this.W.creators&&z.push.apply(z,g.A(this.W.creators));this.W.theBiggestFan&&z.push(this.W.theBiggestFan);return[].concat(g.A(new Set(z)))};
g.Y(WMq,Cs);WMq.prototype.K=function(){return[]};
g.Y(yeJ,Cs);yeJ.prototype.K=function(){return[]};
g.Y(CYJ,Cs);CYJ.prototype.K=function(){return[]};
g.Y(ePd,Cs);ePd.prototype.K=function(){return[]};
g.Y(lY3,Cs);lY3.prototype.K=function(){return[]};
g.Y(vY$,Cs);vY$.prototype.K=function(){return[]};
g.Y(IYJ,Cs);IYJ.prototype.K=function(){return[]};
g.Y(jeE,Cs);jeE.prototype.K=function(){return[]};
g.Y(FMQ,Cs);FMQ.prototype.K=function(){return[]};
g.Y(oYK,Cs);oYK.prototype.K=function(){var z=[];this.W.downloadsList&&z.push(this.W.downloadsList);this.W.smartDownloadsList&&z.push(this.W.smartDownloadsList);this.W.recommendedDownloadsList&&z.push(this.W.recommendedDownloadsList);this.W.refresh&&z.push(this.W.refresh);return[].concat(g.A(new Set(z)))};
g.Y(nYg,y4);nYg.prototype.K=function(){var z=[];this.W.video&&z.push(this.W.video);this.W.playlist&&z.push(this.W.playlist);this.W.videoItem&&z.push(this.W.videoItem);this.W.playlistItem&&z.push(this.W.playlistItem);return[].concat(g.A(new Set(z)))};
g.Y(Qed,Cs);Qed.prototype.K=function(){var z=[];this.W.refresh&&z.push(this.W.refresh);if(this.W.downloads)for(var p=g.m(this.W.downloads),c=p.next();!c.done;c=p.next())z.push.apply(z,g.A((new nYg(c.value)).K()));return[].concat(g.A(new Set(z)))};
g.Y(re1,Cs);re1.prototype.K=function(){var z=[];this.W.localImageEntities&&z.push.apply(z,g.A(this.W.localImageEntities));return[].concat(g.A(new Set(z)))};
g.Y(U71,Cs);U71.prototype.K=function(){var z=[];this.W.playbackData&&z.push(this.W.playbackData);this.W.localImageEntities&&z.push.apply(z,g.A(this.W.localImageEntities));this.W.videoDownloadContextEntity&&z.push(this.W.videoDownloadContextEntity);return[].concat(g.A(new Set(z)))};
g.Y(sem,Cs);sem.prototype.K=function(){return[]};
g.Y(kiQ,Cs);kiQ.prototype.K=function(){var z=[];this.W.fakeChildren&&z.push.apply(z,g.A(this.W.fakeChildren));return[].concat(g.A(new Set(z)))};
g.Y(gYq,Cs);gYq.prototype.K=function(){var z=[];this.W.video&&z.push(this.W.video);this.W.playbackData&&z.push(this.W.playbackData);this.W.offlineVideoPolicy&&z.push(this.W.offlineVideoPolicy);return[].concat(g.A(new Set(z)))};
g.Y(GiK,Cs);GiK.prototype.K=function(){return[]};
g.Y(NI$,Cs);NI$.prototype.K=function(){var z=[];this.W.channelOwner&&z.push(this.W.channelOwner);this.W.videos&&z.push.apply(z,g.A(this.W.videos));this.W.collaboratorChannels&&z.push.apply(z,g.A(this.W.collaboratorChannels));this.W.downloadState&&z.push(this.W.downloadState);this.W.refresh&&z.push(this.W.refresh);return[].concat(g.A(new Set(z)))};
g.Y(fY3,Cs);fY3.prototype.K=function(){var z=[];this.W.video&&z.push(this.W.video);this.W.channelContributor&&z.push(this.W.channelContributor);return[].concat(g.A(new Set(z)))};
g.Y(zym,y4);zym.prototype.K=function(){var z=[];this.W.localImageEntities&&z.push.apply(z,g.A(this.W.localImageEntities));this.W.videoDownloadContextEntity&&z.push(this.W.videoDownloadContextEntity);return[].concat(g.A(new Set(z)))};
g.Y(pR9,y4);pR9.prototype.K=function(){var z=[];this.W.recommendedVideoMetadata&&z.push.apply(z,g.A((new zym(this.W.recommendedVideoMetadata)).K()));return[].concat(g.A(new Set(z)))};
g.Y(cYd,y4);cYd.prototype.K=function(){var z=[];this.W.playbackPosition&&z.push(this.W.playbackPosition);return[].concat(g.A(new Set(z)))};
g.Y(B7v,Cs);B7v.prototype.K=function(){var z=[];this.W.owner&&z.push(this.W.owner);this.W.downloadState&&z.push(this.W.downloadState);this.W.userState&&z.push.apply(z,g.A((new cYd(this.W.userState)).K()));this.W.additionalMetadata&&z.push.apply(z,g.A((new pR9(this.W.additionalMetadata)).K()));return[].concat(g.A(new Set(z)))};
g.Y(HE$,Cs);HE$.prototype.K=function(){var z=[];this.W.userChannelDetails&&z.push(this.W.userChannelDetails);return[].concat(g.A(new Set(z)))};
g.Y(iEg,Cs);iEg.prototype.K=function(){var z=[];this.W.channelOwner&&z.push(this.W.channelOwner);this.W.playbackPosition&&z.push(this.W.playbackPosition);this.W.localImageEntities&&z.push.apply(z,g.A(this.W.localImageEntities));this.W.downloadStatus&&z.push(this.W.downloadStatus);return[].concat(g.A(new Set(z)))};
g.Y(T7v,Cs);T7v.prototype.K=function(){return[]};
g.Y(bEm,Cs);bEm.prototype.K=function(){return[]};
g.Y(VPl,Cs);VPl.prototype.K=function(){return[]};
g.Y(Drq,Cs);Drq.prototype.K=function(){return[]};
g.Y(tPl,Cs);tPl.prototype.K=function(){return[]};
g.Y(XR1,Cs);XR1.prototype.K=function(){return[]};
g.Y(xr9,Cs);xr9.prototype.K=function(){return[]};
g.Y(EVv,Cs);EVv.prototype.K=function(){return[]};
g.Y(qkz,Cs);qkz.prototype.K=function(){return[]};
g.Y(JYv,Cs);JYv.prototype.K=function(){return[]};
g.Y(MPQ,Cs);MPQ.prototype.K=function(){return[]};
g.Y(Yk1,Cs);Yk1.prototype.K=function(){var z=[];this.W.trackDownloadMetadatas&&z.push.apply(z,g.A(this.W.trackDownloadMetadatas));return[].concat(g.A(new Set(z)))};
g.Y(mr$,Cs);
mr$.prototype.K=function(){var z=[];this.W.downloadedTracks&&z.push.apply(z,g.A(this.W.downloadedTracks));this.W.smartDownloadedTracks&&z.push.apply(z,g.A(this.W.smartDownloadedTracks));this.W.downloadedEpisodes&&z.push.apply(z,g.A(this.W.downloadedEpisodes));this.W.downloadedAlbumReleases&&z.push.apply(z,g.A(this.W.downloadedAlbumReleases));this.W.smartDownloadedAlbumReleases&&z.push.apply(z,g.A(this.W.smartDownloadedAlbumReleases));this.W.downloadedPlaylists&&z.push.apply(z,g.A(this.W.downloadedPlaylists));this.W.smartDownloadedPlaylists&&
z.push.apply(z,g.A(this.W.smartDownloadedPlaylists));this.W.metadataOnlyTracks&&z.push.apply(z,g.A(this.W.metadataOnlyTracks));return[].concat(g.A(new Set(z)))};
g.Y(hyJ,Cs);hyJ.prototype.K=function(){var z=[];this.W.trackDownloadMetadatas&&z.push.apply(z,g.A(this.W.trackDownloadMetadatas));return[].concat(g.A(new Set(z)))};
g.Y(PWm,Cs);PWm.prototype.K=function(){var z=[];this.W.playbackData&&z.push(this.W.playbackData);this.W.localImageEntities&&z.push.apply(z,g.A(this.W.localImageEntities));this.W.videoDownloadContextEntity&&z.push(this.W.videoDownloadContextEntity);return[].concat(g.A(new Set(z)))};
g.Y(AYE,Cs);AYE.prototype.K=function(){var z=[];this.W.musicLibraryStatusEntity&&z.push(this.W.musicLibraryStatusEntity);this.W.primaryArtists&&z.push.apply(z,g.A(this.W.primaryArtists));this.W.details&&z.push(this.W.details);this.W.userDetails&&z.push(this.W.userDetails);this.W.tracks&&z.push.apply(z,g.A(this.W.tracks));this.W.share&&z.push(this.W.share);this.W.downloadMetadata&&z.push(this.W.downloadMetadata);this.W.refresh&&z.push(this.W.refresh);return[].concat(g.A(new Set(z)))};
g.Y(OEz,Cs);OEz.prototype.K=function(){var z=[];this.W.albumRelease&&z.push(this.W.albumRelease);this.W.tracks&&z.push.apply(z,g.A(this.W.tracks));return[].concat(g.A(new Set(z)))};
g.Y(wRK,Cs);wRK.prototype.K=function(){var z=[];this.W.albumRelease&&z.push(this.W.albumRelease);return[].concat(g.A(new Set(z)))};
g.Y(RyJ,Cs);RyJ.prototype.K=function(){var z=[];this.W.details&&z.push(this.W.details);this.W.userDetails&&z.push(this.W.userDetails);return[].concat(g.A(new Set(z)))};
g.Y(Sk9,Cs);Sk9.prototype.K=function(){var z=[];this.W.parentArtist&&z.push(this.W.parentArtist);return[].concat(g.A(new Set(z)))};
g.Y($rK,Cs);$rK.prototype.K=function(){var z=[];this.W.parentArtist&&z.push(this.W.parentArtist);return[].concat(g.A(new Set(z)))};
g.Y(K_L,Cs);K_L.prototype.K=function(){return[]};
g.Y(uuv,Cs);uuv.prototype.K=function(){return[]};
g.Y(acg,y4);acg.prototype.K=function(){var z=[];this.W.creatorEntity&&z.push(this.W.creatorEntity);return[].concat(g.A(new Set(z)))};
g.Y(ZEm,Cs);
ZEm.prototype.K=function(){var z=[];this.W.tracks&&z.push.apply(z,g.A(this.W.tracks));this.W.refresh&&z.push(this.W.refresh);this.W.musicLibraryStatusEntity&&z.push(this.W.musicLibraryStatusEntity);this.W.details&&z.push(this.W.details);this.W.downloadMetadata&&z.push(this.W.downloadMetadata);this.W.sideloadMetadata&&z.push(this.W.sideloadMetadata);this.W.userDetails&&z.push(this.W.userDetails);this.W.entryCollection&&z.push(this.W.entryCollection);this.W.share&&z.push(this.W.share);this.W.podcastShowAdditionalMetadata&&z.push.apply(z,
g.A((new acg(this.W.podcastShowAdditionalMetadata)).K()));return[].concat(g.A(new Set(z)))};
g.Y(L_d,Cs);L_d.prototype.K=function(){return[]};
g.Y(drK,Cs);
drK.prototype.K=function(){var z=[];this.W.musicLibraryStatusEntity&&z.push(this.W.musicLibraryStatusEntity);this.W.artists&&z.push.apply(z,g.A(this.W.artists));this.W.audioModeVersion&&z.push(this.W.audioModeVersion);this.W.videoModeVersion&&z.push(this.W.videoModeVersion);this.W.userDetails&&z.push(this.W.userDetails);this.W.details&&z.push(this.W.details);this.W.albumRelease&&z.push(this.W.albumRelease);this.W.share&&z.push(this.W.share);this.W.libraryEdit&&z.push(this.W.libraryEdit);this.W.downloadMetadata&&
z.push(this.W.downloadMetadata);this.W.playbackPosition&&z.push(this.W.playbackPosition);this.W.lyrics&&z.push(this.W.lyrics);return[].concat(g.A(new Set(z)))};
g.Y(W_g,Cs);W_g.prototype.K=function(){var z=[];this.W.parentTrack&&z.push(this.W.parentTrack);return[].concat(g.A(new Set(z)))};
g.Y(yYm,Cs);yYm.prototype.K=function(){var z=[];this.W.parentTrack&&z.push(this.W.parentTrack);return[].concat(g.A(new Set(z)))};
g.Y(CWJ,Cs);CWJ.prototype.K=function(){return[]};
g.Y(ey$,Cs);ey$.prototype.K=function(){return[]};
g.Y(lcz,Cs);lcz.prototype.K=function(){return[]};
g.Y(vVL,Cs);vVL.prototype.K=function(){return[]};
g.Y(IcJ,Cs);IcJ.prototype.K=function(){var z=[];this.W.transfer&&z.push(this.W.transfer);this.W.adsPlaybackData&&z.push.apply(z,g.A(this.W.adsPlaybackData));this.W.drmLicense&&z.push(this.W.drmLicense);this.W.offlineVideoPolicy&&z.push(this.W.offlineVideoPolicy);this.W.videoDownloadContextEntity&&z.push(this.W.videoDownloadContextEntity);return[].concat(g.A(new Set(z)))};
g.Y(j2q,Cs);j2q.prototype.K=function(){return[]};
g.Y(F_l,Cs);F_l.prototype.K=function(){var z=[];this.W.offlineVideoStreams&&z.push.apply(z,g.A(this.W.offlineVideoStreams));this.W.captionTrack&&z.push.apply(z,g.A(this.W.captionTrack));return[].concat(g.A(new Set(z)))};
g.Y(oVL,Cs);oVL.prototype.K=function(){return[]};
g.Y(nVz,Cs);nVz.prototype.K=function(){return[]};
g.Y(Q2J,Cs);Q2J.prototype.K=function(){return[]};
g.Y(rYz,Cs);rYz.prototype.K=function(){return[]};
g.Y(UrQ,Cs);UrQ.prototype.K=function(){return[]};
g.Y(s2Q,Cs);s2Q.prototype.K=function(){return[]};
g.Y(k$v,Cs);k$v.prototype.K=function(){return[]};
g.Y(gV3,Cs);gV3.prototype.K=function(){return[]};
g.Y(G$$,Cs);G$$.prototype.K=function(){return[]};
g.Y(N71,Cs);N71.prototype.K=function(){return[]};
g.Y(fc9,Cs);fc9.prototype.K=function(){return[]};
g.Y(z93,Cs);z93.prototype.K=function(){return[]};
g.Y(pxd,Cs);pxd.prototype.K=function(){return[]};
g.Y(c_q,Cs);c_q.prototype.K=function(){return[]};
g.Y(BYd,Cs);BYd.prototype.K=function(){return[]};
g.Y(H49,Cs);H49.prototype.K=function(){return[]};
g.Y(i4l,Cs);i4l.prototype.K=function(){return[]};
g.Y(TYJ,Cs);TYJ.prototype.K=function(){return[]};
g.Y(b49,Cs);b49.prototype.K=function(){return[]};
g.Y(Vz1,Cs);Vz1.prototype.K=function(){return[]};
var ioK=["browse","music/browse","unplugged/browse"],tVK=["offline/playlist_sync_check"],gOg=["offline"],T4L=["offline/offline_video_playback_position_sync"],VV3=["offline/get_playback_data_entity"],em;lw.getInstance=function(){return g.L(function(z){return z.return(new Promise(function(p){g.iH().then(function(c){c?(lw.instance||(lw.instance=new lw(c)),p(lw.instance)):p(void 0)})}))})};
lw.prototype.get=function(z){var p=this,c,B,H;return g.L(function(T){if(T.W==1)return g.a(T,xyg(p.token),2);if(T.W!=3)return c=T.K,g.a(T,c.get("prefs",z),3);B=T.K;if(!B)return T.return();H=(0,g.y2)();return B.expirationTimestampMs<=H?T.return():T.return(B.value)})};
lw.prototype.set=function(z,p,c){c=c===void 0?31536E3:c;var B=this,H,T,b;return g.L(function(D){if(D.W==1)return H=(0,g.y2)(),T={key:z,value:p,expirationTimestampMs:H+c*1E3},g.a(D,xyg(B.token),2);b=D.K;return g.a(D,g.jj(b,"prefs",T),0)})};
lw.prototype.remove=function(z){var p=this,c;return g.L(function(B){if(B.W==1)return g.a(B,xyg(p.token),2);c=B.K;return g.a(B,c.delete("prefs",z),0)})};
g.Y(vo,g.z6);g.Y(Io,Yg$);Io.prototype.D=function(z,p){p=h9L(p);z=(new TextEncoder).encode(JSON.stringify(z));return this.W.encrypt(z,p)};
Io.prototype.K=function(z,p){if(!(z instanceof Uint8Array))throw EmE(1);var c=new TextDecoder;p=h9L(p);z=this.W.decrypt(z,p);return JSON.parse(c.decode(z))};
var Pnm={accountLinkStatusEntity:CYJ,booleanEntity:$7d,buttonEntity:pxd,captionTrack:CWJ,channelHandle:RPJ,commerceAcquisitionClientPayloadEntity:BYd,commerceCartListEntity:H49,contextNoteFeedEntityPayload:SaK,continuationTokenEntity:GiK,downloadQualityPickerEntity:IYJ,downloadsPageRefreshTokenEntity:FMQ,downloadsPageViewConfigurationEntity:T7v,downloadStatusEntity:jeE,dismissState:k$v,sfvAudioItemCurrentlyPlayingEntity:rYz,emojiFountainDataEntity:fc9,emojiCustomizationSetEntity:N71,fakeChannel:uWz,
fakePlaylist:aYE,fakePlaylistEntryCollection:LMQ,fakeVideo:d7E,fakeVideoDescription:WMq,featuredProductsEntity:qkz,flowStateEntity:yeJ,iconBadgeEntity:i4l,interstitialInteractionStateEntity:lY3,likeButtonAnimationEntity:bEm,liveChatPollStateEntity:vY$,liveViewerLeaderboardChatEntryPointStateEntity:nVz,liveViewerLeaderboardPointsEntity:Q2J,liveReactionsDataEntity:z93,logoEntity:ePd,macroMarkerEntity:VPl,mainDownloadsLibraryEntity:oYK,mainDownloadsListEntity:Qed,mainPlaylistDownloadStateEntity:re1,
mainPlaylistEntity:NI$,mainPlaylistVideoEntity:fY3,mainVideoDownloadStateEntity:U71,mainVideoEntity:B7v,markersEngagementPanelSyncEntity:Drq,markersVisibilityOverrideEntity:tPl,musicAlbumReleaseDetail:OEz,musicAlbumReleaseDownloadMetadataEntity:Yk1,musicAlbumRelease:AYE,musicAlbumReleaseUserDetail:wRK,musicArtistDetail:Sk9,musicArtist:RyJ,musicArtistUserDetail:$rK,musicDownloadsLibraryEntity:mr$,musicLibraryEdit:K_L,musicLibraryStatusEntity:uuv,musicPlaylist:ZEm,musicPlaylistDownloadMetadataEntity:hyJ,
musicShare:L_d,musicTrackDetail:W_g,musicTrackDownloadMetadataEntity:PWm,musicTrack:drK,musicTrackUserDetail:yYm,offlineOrchestrationActionWrapperEntity:ey$,offlineVideoPolicy:lcz,offlineVideoStreams:vVL,offlineabilityEntity:sem,orchestrationWebSamplingEntity:kiQ,pageHeaderEntity:gV3,pdpStateEntity:TYJ,pinnedProductEntity:JYv,playbackData:IcJ,playerStateEntity:XR1,quantityIncrementerEntity:b49,refresh:j2q,saveToPlaylistListEntity:UrQ,settingEntity:s2Q,stringEntity:KMQ,suggestedFeedbackChipStateEntity:xr9,
transfer:F_l,trendingOfferEntity:MPQ,videoDownloadContextEntity:oVL,videoOverviewAsyncDataEntity:Vz1,videoPlaybackPositionEntity:c_q,votingEntity:G$$,ytMainChannelEntity:HE$,youchatPendingResponseEntity:EVv,ytMainDownloadedVideoEntity:gYq,ytMainVideoEntity:iEg};g.Y(rx,Yg$);rx.prototype.D=function(z){return z};
rx.prototype.K=function(z){if(z instanceof Uint8Array)throw EmE(0);return z};
g.Y(U1,g.e);U1.prototype.observe=function(z){var p=this;this.observers.push(z);return function(){var c=p.observers.indexOf(z);c>=0&&p.observers.splice(c,1)}};
U1.prototype.K=function(z){y_z(this,z.data)};
U1.prototype.m0=function(){this.channel.close()};
var IRm,C6l=new g.Wn("elementsCommand");var Of=new g.Wn("entityBatchUpdate");var wVq=new g.Wn("downloadStatusEntity");var Iv3=new g.Wn("mainPlaylistEntityActionMetadata");var sf=new g.Wn("mainVideoEntityActionMetadata");var kwQ=new g.Wn("musicPlaylistEntityActionMetadata");var P3m=new g.Wn("musicTrackEntityActionMetadata");var pnE=new g.Wn("localImageEntityActionMetadata");var W0=new g.Wn("playbackDataActionMetadata");var eRq=new g.Wn("transferEntityActionMetadata");var ASE=new g.Wn("videoPlaybackPositionEntityActionMetadata");var pVK;new g.OE;new g.OE;TKQ.prototype.request=function(z,p,c){p=p===void 0?{}:p;return this.locks.request(z,p,function(B){return c(B)})};var p1=g.jQ.caches,zR,XVm;fs.prototype.open=function(z){return p1.open(D3m(z))};
fs.prototype.has=function(z){return p1.has(D3m(z))};
fs.prototype.delete=function(z){return p1.delete(D3m(z))};
fs.prototype.match=function(z,p){var c=this,B,H,T,b,D,t;return g.L(function(X){switch(X.W){case 1:return g.a(X,c.keys(),2);case 2:B=X.K,H=g.m(B),T=H.next();case 3:if(T.done){X.hD(5);break}b=T.value;return g.a(X,c.open(b),6);case 6:return D=X.K,g.a(X,D.match(z,p),7);case 7:if(t=X.K)return X.return(t);T=H.next();X.hD(3);break;case 5:return X.return()}})};
g.Y(Vuv,fs);Vuv.prototype.keys=function(){var z,p,c,B,H,T,b,D,t;return g.L(function(X){if(X.W==1)return z=[],p=g.pt("CacheStorage keys"),g.a(X,p1.keys(),2);c=X.K;B=g.m(c);for(H=B.next();!H.done;H=B.next()){T=H.value;var x=T.indexOf(":");b=x===-1?{CV:T}:{CV:T.substring(0,x),datasyncId:T.substring(x+1)};D=b.CV;t=b.datasyncId;t===p&&z.push(D)}return X.return(z)})};g.Y(B0,g.e);B0.prototype.D=function(z){this.api.AD("onOfflineOperationFailure",z.data)};
B0.prototype.X=function(z){this.api.publish("offlinetransferpause",z.data)};
B0.prototype.m0=function(){var z;(z=this.W)==null||z.close();var p;(p=this.K)==null||p.close()};qY1.prototype.mV=function(){this.W&&i7(this)};
qY1.prototype.pS=function(){this.K&&this.K.resolve();this.D=this.W=!1;this.U()};var fqQ=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var d3$="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var nOK="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.Y(xVJ,Z4);xVJ.prototype.K=function(z){return D4(z)?JSz(this,z):tK(z)?mV1(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};g.Y(hR$,Z4);hR$.prototype.K=function(z){return tK(z)?P8Q(this,z):Oxv(z)?Oog(this,z):Xv(z)?wOq(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};g.V=RRz.prototype;g.V.NUp=function(z){var p=this,c,B,H,T;return g.L(function(b){if(!g.r(z.state,128))return b.hD(0);c=z.state.DN;var D=(B=c)==null?void 0:B.errorCode,t=(H=c)==null?void 0:H.lC;T=D==="net.connect"&&t===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(D==null?0:D.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.a(b,p.Jh(p.player.getVideoData().videoId,T),0)})};
g.V.Jh=function(z,p){var c=this;return g.L(function(B){if(B.W==1){if(c.K)return B.return();c.K=!0;return p==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(e6(c,z,!1,!0),B.hD(0)):g.a(B,C1(c,z),3)}g.eO(z,4);return g.a(B,c.W.Jh(p),0)})};
g.V.Bv=function(z){z.status===2?(z.status!==this.D&&(P5E(this.W),g.eO(z.videoId,2)),z.QN&&So1(this.W,z.videoId,z.QN)):z.status===4?(C1(this,z.videoId),this.Jh(z.videoId,z.jT?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):z.status===1&&R_K(this.W);this.D=z.status;this.api.AD("localmediachange",{videoId:z.videoId,status:z.status})};
g.V.XZ=function(){var z=this,p;return g.L(function(c){if(c.W==1){if(z.K)return c.return();z.K=!0;p=z.player.getVideoData().videoId;return g.a(c,C1(z,p),2)}return g.a(c,z.W.XZ(),0)})};
g.V.Sx=function(z){switch(z){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.V.Y=function(z){return this.api.N().Y(z)};g.Y(LGm,Z4);LGm.prototype.K=function(z){return D4(z)?WGJ(this,z):tK(z)?yS3(this,z):Oxv(z)?C8v(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};FGE.prototype.W=function(z,p){var c=z.action.actionMetadata.priority-p.action.actionMetadata.priority;c===0&&(z.W<p.W?c=-1:z.W>p.W&&(c=1));return c};g.Y(l7,g.e);l7.prototype.m0=function(){this.U&&this.U();g.e.prototype.m0.call(this)};
l7.prototype.createAction=function(z,p){var c=g.Jz(z.entityKey).entityType,B=g.Zu(16);return new Mf(c,B,z,p.actionId,p.rootActionId)};
l7.prototype.Dt=function(z){var p=this,c,B,H,T,b,D,t,X,x;return g.L(function(E){if(E.W==1){if(p.qZ())return E.return();B=(c=z.offlineOrchestrationActionWrapperEntity)!=null?c:new Set;H=[];T=g.m(B);for(b=T.next();!b.done;b=T.next())D=b.value,t=g.Jz(D),X=t.entityId,QAl(p.W,X)||H.push(D);return g.a(E,cnL(p,H),2)}x=E.K;return g.a(E,p4J(p,x),0)})};
l7.prototype.retry=function(){var z=this;return g.L(function(p){return g.a(p,BD$(z),0)})};iI9.prototype.ym=function(z,p){p=p===void 0?!0:p;var c=this,B,H,T,b,D,t,X,x;return g.L(function(E){switch(E.W){case 1:if(!c.W)return E.return();B=[];H=g.Hc(c.W.K,p);T=[];for(b={q7:0};b.q7<H.length;b={q7:b.q7},b.q7++)D=H[b.q7],t=c.W.Vq(D,"json3"),X=g.e9(t,{withCredentials:!0,format:"RAW"},3,500).then(function(q){return function(J){J={metadata:g.Aj(H[q.q7]),trackData:J.xhr.responseText};T.push(J)}}(b)).zL(function(q){c0("Caption fetch error",q)}),B.push(X);
return g.a(E,wFq(B),2);case 2:return g.Ox(E,3),g.a(E,sj1(z,T),5);case 5:g.RE(E,0);break;case 3:x=g.SQ(E),c0("Caption DB transaction error",x),g.Ai(E)}})};g.Y(v0,g.e);v0.prototype.m0=function(){this.K&&this.K();g.e.prototype.m0.call(this)};
v0.prototype.D=function(z){var p=this,c,B,H,T,b,D,t,X;return g.L(function(x){B=(c=z.transfer)!=null?c:new Set;H=[];T=g.m(B);for(b=T.next();!b.done;b=T.next())D=b.value,t=g.Jz(D),X=t.entityId,H.push(X);return H.length===0?x.return():g.a(x,Vo1(p,H),0)})};g.Y(EfQ,g.e);g.V=EfQ.prototype;g.V.m0=function(){this.tD&&this.tD();this.T$.dispose();this.X.dispose();this.fH&&g.kr(this.V.AC,this.fH);this.YA&&g.kr(this.V.AC,this.YA);g.e.prototype.m0.call(this)};
g.V.jII=function(z){var p=this,c,B,H;return g.L(function(T){switch(T.W){case 1:c=g.M9(z,"transfer");if(p.W&&c===p.W.key){e6(p.G,p.L,!0);p.X.stop();T.hD(0);break}return g.a(T,s1(p.K,{mode:"readwrite",xt:!0},function(b){return jm(b,c,"transfer").then(function(D){if(D&&D.transferState!=="TRANSFER_STATE_COMPLETE"&&D.transferState!=="TRANSFER_STATE_FAILED")return D.transferState="TRANSFER_STATE_PAUSED_BY_USER",ns(b,D,"transfer").then(function(){return D})})}),3);
case 3:B=T.K;if(!B){T.hD(0);break}if(!z||!p.D){T.hD(5);break}return g.a(T,xz(z,p.D,p.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.a(T,Fv(p,z),7);case 7:H=T.K,P61({videoId:z,Ls:B,offlineModeType:H}),g.Ai(T)}})};
g.V.QI0=function(){var z=this;if(this.W&&this.L){e6(this.G,this.L,!1);var p=this.W,c=(p==null?0:p.key)?g.Jz(p.key).entityId:"";c&&this.D&&(new Promise(function(B,H){xz(c,z.D,z.K,"DOWNLOAD_STATE_PAUSED").catch(function(T){H(T)})})).catch(function(B){c0("Download state setting error",B)})}this.X.stop()};
g.V.gf=function(){this.W?MoK(this,this.W):j6(this)};
g.V.GA=function(z){var p=this;return g.L(function(c){switch(c.W){case 1:if(!p.W){c.hD(2);break}if(p.W.transferState==="TRANSFER_STATE_COMPLETE"||p.W.transferState==="TRANSFER_STATE_FAILED"||!z.transfer||!z.transfer.has(p.W.key)){c.hD(3);break}return g.a(c,gx(p.K,p.W.key,"transfer"),4);case 4:p.W=c.K;if(p.W){c.hD(3);break}return g.a(c,Yog(p),3);case 3:if(p.W)return c.return();case 2:return g.a(c,j6(p),0)}})};
g.V.Jh=function(z,p){var c=this,B,H,T,b,D;return g.L(function(t){switch(t.W){case 1:if(!c.W){oT(c,"onTransferFailure: "+z);t.hD(2);break}B=c.W;T=((H=B)==null?0:H.key)?g.Jz(B.key).entityId:"";a:switch(z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var X=!1;break a;default:X=!0}return X&&$5z(c)?g.a(t,n1(c,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.a(t,
KaL(c,z),5);case 5:if(!T||!c.D){t.hD(2);break}return g.a(t,xz(T,c.D,c.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.a(t,Fv(c,T),9);case 9:b=t.K;b7({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:T,Ls:B,offlineModeType:b});if(!T||!c.D){t.hD(2);break}return g.a(t,xz(T,c.D,c.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:IT(c),D=j6(c,!0),p&&p(D),g.Ai(t)}})};
g.V.XZ=function(z){var p=this,c,B,H,T,b,D,t,X,x,E,q,J;return g.L(function(M){switch(M.W){case 1:if(!p.W){oT(p,"onMaybeTransferStreamsExpired");M.hD(2);break}return $5z(p)?g.a(M,n1(p,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.a(M,KaL(p,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!p.D){M.hD(2);break}c=p.W;H=((B=c)==null?0:B.key)?g.Jz(c.key).entityId:"";if(!H){M.hD(2);break}return g.a(M,xz(H,p.D,p.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return p.W||oT(p,"onMaybeTransferStreamsExpiredRetryAttempting"),
T=p.W,D=((b=T)==null?0:b.key)?g.Jz(T.key).entityId:"",g.a(M,Fv(p,D),10);case 10:return t=M.K,b7({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:D,Ls:T,offlineModeType:t}),X=$3E(),g.sF(X,W0,{isEnqueuedForExpiredStreamUrlRefetch:!0}),x=g.M9(D,"playbackData"),E={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:x,actionMetadata:X},q=m3(new Mf("playbackData",D,E)),g.a(M,ks(p.K,q,"offlineOrchestrationActionWrapperEntity"),2);case 2:IT(p),J=j6(p,!0),
z&&z(J),g.Ai(M)}})};
var L6K={},ujE=(L6K.TRANSFER_STATE_TRANSFERRING=1,L6K.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,L6K);g.V=Q6.prototype;g.V.Jp=function(){return this.L.promise};
g.V.T4=function(){if(this.K&&this.G)return this.L.promise;LaE(this).then(this.L.resolve).catch(this.L.reject);return this.L.promise};
g.V.TM=function(z){var p={};return p.playbackData=new xVJ(z,this.Wq,this.W),p.transfer=new LGm(z,this.Wq),p.videoPlaybackPositionEntity=new hR$(z,this.Wq),p};
g.V.n0=function(){var z=this;return g.L(function(p){return z.K?g.a(p,qoL(z.K),0):p.hD(0)})};
g.V.vR=function(){var z=this,p,c;return g.L(function(B){if(B.W==1)return z.K||z.G?g.a(B,z.Jp(),2):B.return();z.S!==void 0&&(g.S9(z.S),z.S=void 0);z.X!==void 0&&(g.S9(z.X),z.X=void 0);(p=z.K)==null||p.dispose();z.K=void 0;(c=z.G)==null||c.dispose();z.G=void 0;z.api.AD("onOrchestrationLostLeader");z.L=new g.OE;g.Ai(B)})};
g.V.isOrchestrationLeader=function(){return this.D.W};
g.V.fp=function(){return g.L(function(z){return z.return(!1)})};
g.V.CY=function(z){var p=this.W;p.api.publish("offlinetransferpause",z);var c;(c=p.K)==null||c.postMessage(z)};
g.V.gf=function(z){var p,c;return g.L(function(B){if(B.W==1)return g.a(B,NX(),2);p=B.K;if(!p)return B.return();c=g.M9(z,"transfer");return g.a(B,s1(p,{mode:"readwrite",xt:!0},function(H){var T=jm(H,c,"transfer"),b=jm(H,g.M9(z,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Zg.all([T,b]).then(function(D){D=g.m(D);var t=D.next().value;var X=D.next().value;return t&&t.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(t.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",ns(H,t,"transfer").then(function(){b7({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:z,Ls:t,offlineModeType:X==null?void 0:X.offlineModeType});return g.Zg.resolve(null)})):g.Zg.resolve(null)})}),0)})};
g.V.XS=function(z){z=z===void 0?43200:z;var p=this,c,B,H,T,b,D,t,X;return g.L(function(x){if(x.W==1)return p.V.Bn()?g.a(x,NX(),2):x.return(d5Q());if(x.W!=3){c=x.K;if(!c)return x.return([]);B=Date.now()/1E3;return g.a(x,GA(c,"offlineVideoPolicy"),3)}H=x.K;T=[];b=g.m(H);for(D=b.next();!D.done;D=b.next())t=D.value,Number(t.lastUpdatedTimestampSeconds)+z<=B&&(X=g.Jz(t.key).entityId,T.push(X));return T.length?x.return(rZ(p,T,p.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):x.return([])})};
g.V.deleteAll=function(){return rZ(this,["!*$_ALL_ENTITIES_!*$"],this.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.V.refreshAllStaleEntities=function(z){var p=this;return g.L(function(c){return c.W==1?g.a(c,p.XS(z),2):c.return(c.K)})};
g.V.setUpPositionSyncInterval=function(z){var p=this;this.X!==void 0&&(g.S9(this.X),this.X=void 0);var c=z!=null?z:864E5;this.X=g.wS(function(){p.vY(c)},c)};
g.V.vY=function(z){var p=this,c,B,H,T,b,D;return g.L(function(t){switch(t.W){case 1:return g.Ox(t,2),g.a(t,lw.getInstance(),4);case 4:c=t.K;if(!c)throw Error("prefStorage is undefined");return g.a(t,c.get("psi"),5);case 5:B=t.K;T=((H=B)==null?0:H.DG)?Number(B.DG)/1E3:0;b=Date.now();if(!(T+z<=b)){t.hD(6);break}return g.a(t,rZ(p,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.RE(t,0);break;case 2:D=g.SQ(t),c0("Offline manager error",D),
g.Ai(t)}})};
g.V.u0=function(){var z=this,p,c,B,H,T,b,D;return g.L(function(t){if(t.W==1)return g.a(t,NX(),2);if(t.W!=3)return(p=t.K)?g.a(t,GA(p,"transfer"),3):t.return([]);c=t.K;B=[];H=g.m(c);for(T=H.next();!T.done;T=H.next())b=T.value,b.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&b.key&&(D=g.Jz(b.key).entityId,B.push(D));return t.return(ynz(z,B))})};
g.V.xZ=function(){return g.L(function(z){return z.return([])})};
g.V.Vu=function(){return g.L(function(z){g.Ai(z)})};
g.V.nf=function(){return g.L(function(z){g.Ai(z)})};g.Y(C5z,Z4);C5z.prototype.K=function(z){return D4(z)?vf9(this,z):tK(z)?jYm(this,z):Xv(z)?FaK(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var Uf=[10];g.Y(U5q,Z4);U5q.prototype.K=function(z){return D4(z)?gfq(this,z):tK(z)?GVd(this,z):Xv(z)?ND1(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var kV3=[10];g.Y(z4Q,Z4);z4Q.prototype.K=function(z){return tK(z)?cqE(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};g.Y(Bjl,Q6);g.V=Bjl.prototype;g.V.TM=function(z){var p=Q6.prototype.TM.call(this,z);p.mainVideoEntity=new U5q(z,this.Wq,this.W);p.mainPlaylistEntity=new C5z(z,this.Wq,this.W);p.mainDownloadsListEntity=new z4Q(z,this.Wq,this.W);return p};
g.V.refreshAllStaleEntities=function(z,p){var c=this,B,H,T,b,D,t,X,x,E,q,J;return g.L(function(M){switch(M.W){case 1:B=[];if(!c.Wq.Y("web_player_offline_playlist_auto_refresh")){M.hD(2);break}return g.a(M,HQQ(c,z,p),3);case 3:B=M.K;case 2:return g.a(M,lw.getInstance(),4);case 4:return H=M.K,g.a(M,(T=H)==null?void 0:T.get("sdois"),5);case 5:return b=M.K,g.a(M,(D=H)==null?void 0:D.get("lmqf"),6);case 6:t=M.K;if(!b){M.hD(7);break}x=B;E=x.concat;return g.a(M,iQL(c,b,(X=t)!=null?X:"SD",z===0),8);case 8:B=
E.call(x,M.K);case 7:return q=B,J=q.concat,g.a(M,Q6.prototype.refreshAllStaleEntities.call(c,z,p),9);case 9:return B=J.call(q,M.K),M.return(B)}})};
g.V.fp=function(z){var p,c,B,H,T,b,D,t;return g.L(function(X){if(X.W==1)return g.a(X,NX(),2);if(X.W!=3)return(p=X.K)?g.a(X,gx(p,g.ZE,"mainDownloadsListEntity"),3):X.return(!1);c=X.K;if((B=c)==null?0:(H=B.downloads)==null?0:H.length)for(T=g.M9(z,"mainVideoEntity"),b=g.m(c.downloads),D=b.next();!D.done;D=b.next())if(t=D.value,t.videoItem===T)return X.return(!0);return X.return(!1)})};
g.V.xZ=function(){var z=this,p,c,B,H,T,b,D,t;return g.L(function(X){if(X.W==1)return g.a(X,NX(),2);if(X.W!=3)return(p=X.K)?g.a(X,GA(p,"downloadStatusEntity"),3):X.return([]);c=X.K;B=[];H=g.m(c);for(T=H.next();!T.done;T=H.next())b=T.value,b.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&b.key&&(D=g.Jz(b.key).entityId,B.push(D));return B.length?(t={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},X.return(rZ(z,B,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
t))):X.return([])})};
g.V.nf=function(){var z;return g.L(function(p){return p.W==1?g.a(p,NX(),2):(z=p.K)?g.a(p,s1(z,{mode:"readwrite",xt:!0},function(c){return Ft(c,"mainVideoEntity").then(function(B){var H=[];B=g.m(B);for(var T=B.next();!T.done;T=B.next()){T=T.value;var b=void 0;(b=T.userState)!=null&&b.playbackPosition||(b=g.Jz(T.key).entityId,b={key:g.M9(b,"videoPlaybackPositionEntity"),videoId:b,lastPlaybackPositionSeconds:"0"},H.push(ns(c,b,"videoPlaybackPositionEntity")),T.userState={playbackPosition:b.key},H.push(ns(c,
T,"mainVideoEntity")))}return g.Zg.all(H)})}),0):p.return()})};
g.V.Vu=function(){var z,p,c,B,H,T,b,D,t,X,x,E,q,J,M,P,O,R,K,Z,W,v,zY,U,HD,VW,f,F,N,h,n,FY,Rg,Md,uf,zv,bE,m1;return g.L(function(w){if(w.W==1)return g.a(w,NX(),2);if(w.W!=3){z=w.K;if(!z)return w.return();p=g.M9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.a(w,s1(z,{mode:"readonly",xt:!0},function(S){return g.Zg.all([jm(S,p,"mainDownloadsListEntity"),jm(S,g.ZE,"mainDownloadsListEntity"),Ft(S,"mainVideoEntity"),Ft(S,"mainPlaylistEntity")])}),3)}c=w.K;
B=g.m(c);H=B.next().value;T=B.next().value;b=B.next().value;D=B.next().value;t=H;X=T;x=b;E=D;q=new Set;if((J=t)==null?0:(M=J.downloads)==null?0:M.length)for(P=g.m(t.downloads),O=P.next();!O.done;O=P.next())R=O.value,K=void 0,(Z=(K=R.videoItem)!=null?K:R.playlistItem)&&q.add(Z);if((W=X)==null?0:(v=W.downloads)==null?0:v.length)for(zY=g.m(X.downloads),U=zY.next();!U.done;U=zY.next())HD=U.value,HD.videoItem&&q.add(HD.videoItem);VW=new Set;f=[];F=g.m(E);for(N=F.next();!N.done;N=F.next()){h=N.value;if(h.videos)for(n=
g.m(h.videos),FY=n.next();!FY.done;FY=n.next())Rg=FY.value,(Md=JSON.parse(g.Jz(Rg).entityId).videoId)&&VW.add(Md);h.key&&!q.has(h.key)&&f.push(h.key)}uf=g.m(x);for(zv=uf.next();!zv.done;zv=uf.next())bE=zv.value,bE.key&&!q.has(bE.key)&&(m1=g.Jz(bE.key).entityId,VW.has(m1)||f.push(bE.key));return f.length?g.a(w,ILd(z,f),0):w.hD(0)})};g.Y(Tjg,Z4);Tjg.prototype.K=function(z){return D4(z)?VYE(this,z):tK(z)?DRq(this,z):Xv(z)?tYJ(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var kz=[10];g.Y(xR1,Z4);xR1.prototype.K=function(z){return D4(z)?q6E(this,z):tK(z)?Jqq(this,z):Xv(z)?MYK(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var gZ=[10];g.Y(h4$,Z4);h4$.prototype.K=function(z){return D4(z)?wnL(this,z):tK(z)?R4d(this,z):Xv(z)?S6l(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var OQg=[10];g.Y(GR,Q6);GR.prototype.TM=function(z){var p=Q6.prototype.TM.call(this,z);p.musicTrack=new h4$(z,this.W);p.musicPlaylist=new xR1(z,this.W);p.musicAlbumRelease=new Tjg(z,this.W);return p};
GR.prototype.refreshAllStaleEntities=function(z,p){var c=this,B,H,T;return g.L(function(b){if(b.W==1)return g.a(b,K63(c,z,p),2);if(b.W!=3)return H=B=b.K,T=H.concat,g.a(b,Q6.prototype.refreshAllStaleEntities.call(c,z,p),3);B=T.call(H,b.K);return b.return(B)})};g.Y(um9,g.Ms);g.V=um9.prototype;g.V.create=function(){var z=this;g.l(this,this.events);g.cX(this.Wq)?this.W=new Bjl(this.Wq,this.player):g.rn(this.Wq)&&(this.W=new GR(this.Wq,this.player));this.events.Z(this.player,"onPlaybackStartExternal",function(){z.Dm()});
this.events.Z(this.player,"videodatachange",function(){z.Dm()});
this.Wq.Y("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.IS)};
g.V.Ln=function(){return!1};
g.V.HP=function(z,p,c,B){var H=this;return g.L(function(T){return H.W?T.return(rZ(H.W,z,p,c,B)):T.return(Promise.reject())})};
g.V.deleteAll=function(){return this.W.deleteAll()};
g.V.XS=function(z){return this.W.XS(z)};
g.V.refreshAllStaleEntities=function(z){return this.W.refreshAllStaleEntities(z)};
g.V.setUpPositionSyncInterval=function(z){this.W.setUpPositionSyncInterval(z)};
g.V.CY=function(z){this.W.CY(z)};
g.V.gf=function(z){return this.W.gf(z)};
g.V.Dm=function(){var z=this,p;return g.L(function(c){p=z.player.getVideoData();return g.ig(p)?a_$(p)&&z.K!==p.clientPlaybackNonce?g.a(c,ZQ9(z,p),0):c.hD(0):c.return()})};
g.V.IS=function(z){var p=this,c,B,H,T,b,D,t;return g.L(function(X){if(X.W==1)return c=p.player.getVideoData(),B=c.NZ,g.wn(z,2)||g.wn(z,512)?g.a(X,NX(),2):X.return();if(X.W!=3){H=X.K;if(!H)return c0("PES is undefined"),X.return();T=c.videoId;return g.a(X,gx(H,g.M9(T,"mainVideoEntity"),"mainVideoEntity"),3)}b=X.K;if(!b)return X.return();D=Math.floor(B).toString();t={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:D}};return g.a(X,p.HP([T],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
t),0)})};
g.V.isOrchestrationLeader=function(){return this.W.isOrchestrationLeader()};
g.V.updateDownloadState=function(z,p){var c,B,H,T;return g.L(function(b){if(b.W==1)return g.a(b,NX(),2);c=b.K;if(!c)return c0("PES is undefined"),b.return();B=g.Jz(z);H=B.entityType;T=B.entityId;return g.a(b,xz(T,H,c,p,!0),0)})};g.JV("offline",um9);})(_yt_player);
